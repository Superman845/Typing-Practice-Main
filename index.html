<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Professional Typing Practice Tutor</title>
    <style>
:root {
    --bg-color: #ffffff;
    --text-color: #000000;
    --primary-color: #4CAF50;
    --secondary-color: #2196F3;
    --error-color: #f44336;
    --success-color: #4CAF50;
    --key-bg: #f0f0f0;
    --key-border: #ccc;
    --key-active: #e0e0e0;
    --panel-bg: #f9f9f9;
    --border-color: #ddd;
    --keyboard-text-color: #000000;
    --hue: 210;
    --primary: hsl(var(--hue), 70%, 50%);
    --primary-dark: hsl(var(--hue), 70%, 40%);
}

[data-theme="dark"] {
    --bg-color: #1a1a1a;
    --text-color: #ffffff;
    --key-bg: #333333;
    --key-border: #555555;
    --key-active: #444444;
    --panel-bg: #2a2a2a;
    --border-color: #555555;
}

[data-theme="night"] {
    --bg-color: #0d1117;
    --text-color: #c9d1d9;
    --key-bg: #21262d;
    --key-border: #30363d;
    --key-active: #373e47;
    --panel-bg: #161b22;
    --border-color: #30363d;
}

[data-theme="blue"] {
    --bg-color: #e3f2fd;
    --text-color: #0d47a1;
    --key-bg: #bbdefb;
    --key-border: #90caf9;
    --key-active: #64b5f6;
    --panel-bg: #f3e5f5;
    --border-color: #90caf9;
}

[data-theme="green"] {
    --bg-color: #e8f5e8;
    --text-color: #1b5e20;
    --key-bg: #c8e6c9;
    --key-border: #a5d6a7;
    --key-active: #81c784;
    --panel-bg: #f1f8e9;
    --border-color: #a5d6a7;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent !important;
    -webkit-touch-callout: none !important;
    -webkit-user-select: none !important;
    -moz-user-select: none !important;
    -ms-user-select: none !important;
    user-select: none !important;
    outline: none !important;
}

*:focus, *:active, *:visited, *:hover {
    outline: 0 !important;
    outline: none !important;
    box-shadow: none !important;
    -webkit-tap-highlight-color: rgba(0,0,0,0) !important;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: all 0.3s ease;
    overflow-x: hidden;
    zoom: 88%;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    position: relative;
}

/* Header Styles */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.level-selector {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.level-btn, .lesson-btn, .dashboard-btn {
    padding: 8px 16px;
    border: 2px solid var(--border-color);
    background: var(--key-bg);
    color: var(--text-color);
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.level-btn:hover, .lesson-btn:hover, .dashboard-btn:hover {
    background: var(--key-active);
    transform: translateY(-2px);
}

.level-btn.active, .lesson-btn.active {
    background: var(--primary-color);
    color: white;
}

.dashboard-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    font-weight: bold;
}

.dashboard-btn:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.header-controls {
    display: flex;
    gap: 20px;
    align-items: center;
}

.voice-btn, .help-btn, .lock-btn, .settings-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
    color: white;
}

.voice-btn {
    background: #FF5722;
}

.voice-btn:hover {
    background: #E64A19;
    transform: translateY(-2px);
}

.voice-btn.listening {
    background: #4CAF50;
    animation: pulse 1s infinite;
}

.help-btn {
    background: #9C27B0;
}

.help-btn:hover {
    background: #7B1FA2;
    transform: translateY(-2px);
}

.lock-btn {
    background: var(--error-color);
}

.lock-btn:hover {
    background: #d32f2f;
    transform: translateY(-2px);
}

.lock-btn.locked {
    background: var(--primary-color);
}

.lock-btn.locked:hover {
    background: #45a049;
}

.settings-btn {
    background: var(--secondary-color);
}

.settings-btn:hover {
    background: #1976D2;
    transform: translateY(-2px);
}

/* Stats Display with Glassmorphism */
.stats-display {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
    padding: 15px;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    animation: slideIn 0.5s ease-out;
}

.stat-item {
    text-align: center;
}

.stat-value {
    font-size: 24px;
    font-weight: bold;
    color: var(--primary-color);
}

.stat-label {
    font-size: 14px;
    color: var(--text-color);
    opacity: 0.7;
}

/* Progress Bar */
.lesson-progress {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    padding: 10px;
    background: var(--panel-bg);
    border-radius: 8px;
    border: 1px solid var(--border-color);
}

.progress-track {
    flex: 1;
    height: 8px;
    background: var(--border-color);
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    border-radius: 4px;
    transition: width 0.3s ease;
    width: 0%;
}

.progress-text {
    font-weight: bold;
    color: var(--primary-color);
    min-width: 40px;
}

/* Typing Area */
.typing-area {
    margin-bottom: 20px;
}

.text-display {
    padding: 20px;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    background: var(--panel-bg);
    font-family: 'Courier New', monospace;
    font-size: 35px;
    line-height: 1.6;
    min-height: 30px;
    overflow: hidden;
    white-space: nowrap;
    position: relative;
    resize: vertical;
    display: flex;
    justify-content: center;
    align-items: center;
}

.text-container {
    display: inline-block;
    transition: transform 0.3s ease;
    will-change: transform;
    white-space: nowrap;
    min-width: 100%;
}

.char {
    font-size: inherit;
    transition: all 0.3s ease;
    display: inline-block;
    width: 0.6em;
    text-align: center;
}

.char.correct {
    color: var(--success-color);
    background-color: rgba(76, 175, 80, 0.1);
    opacity: 0.3;
}

.char.incorrect {
    color: var(--error-color);
    background-color: rgba(244, 67, 54, 0.1);
    opacity: 0.3;
}

.char.current {
    background-color: var(--secondary-color);
    color: white;
    animation: blink 1s infinite;
    opacity: 1;
}

.char.upcoming {
    opacity: 1;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0.3; }
}

@keyframes slideIn {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.finger-hint {
    margin: 10px 0;
    padding: 10px;
    background: var(--panel-bg);
    border-radius: 5px;
    border: 1px solid var(--border-color);
    font-weight: bold;
    text-align: center;
}

/* Lesson Controls */
.lesson-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
}

.control-btn {
    padding: 10px 20px;
    border: 2px solid var(--border-color);
    background: var(--key-bg);
    color: var(--text-color);
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.control-btn:hover {
    background: var(--key-active);
    transform: translateY(-2px);
}

.start-stop-btn {
    padding: 15px 30px;
    font-size: 18px;
    font-weight: bold;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 0 10px;
}

.start-btn {
    background: var(--primary-color);
    color: white;
}

.start-btn:hover {
    background: #45a049;
    transform: translateY(-2px);
}

.stop-btn {
    background: var(--error-color);
    color: white;
}

.stop-btn:hover {
    background: #d32f2f;
    transform: translateY(-2px);
}

/* Keyboard Styles */
.keyboard {
    background: var(--panel-bg);
    padding: 20px;
    border-radius: 10px;
    border: 2px solid var(--border-color);
    user-select: none;
    transition: all 0.3s ease;
}

.keyboard.touch-typing-enabled .key {
    cursor: pointer;
    user-select: none;
}

.keyboard.touch-typing-enabled .key:hover {
    background: var(--key-bg) !important;
    color: var(--keyboard-text-color) !important;
    transform: translateY(-2px);
}

.keyboard-row {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-bottom: 5px;
}

.key {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    background: var(--key-bg);
    border: 2px solid var(--key-border);
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: bold;
    position: relative;
    color: var(--keyboard-text-color, #000) !important;
}

.key:hover {
    background: var(--key-bg) !important;
    color: var(--keyboard-text-color) !important;
    transform: translateY(-2px);
}

.key.next {
    background: var(--secondary-color);
    color: white;
    animation: pulse 1s infinite;
}

.keyboard:not(.gaming):not(.retro):not(.neon) .key.next {
    background: #4CAF50 !important;
    color: white !important;
    border: 2px solid #45a049 !important;
    box-shadow: 0 0 10px rgba(76, 175, 80, 0.5) !important;
}

.key.space { min-width: 200px; }
.key.shift, .key.ctrl, .key.alt { min-width: 60px; }
.key.tab { min-width: 50px; }
.key.caps { min-width: 70px; }
.key.enter { min-width: 80px; }
.key.backspace { min-width: 80px; }

/* Keyboard Themes */
.keyboard.gaming {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: 2px solid #764ba2;
}

.keyboard.gaming .key {
    background: linear-gradient(145deg, #667eea, #764ba2);
    border: 2px solid #5a67d8;
    color: white;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
}

.keyboard.gaming .key:hover {
    background: linear-gradient(145deg, #764ba2, #667eea);
    box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
}

.keyboard.gaming .key.next {
    background: linear-gradient(145deg, #2196F3, #1976D2);
    color: white;
    box-shadow: 0 0 15px rgba(33, 150, 243, 0.8);
}

.keyboard.retro {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    border: 2px solid #f5576c;
}

.keyboard.retro .key {
    background: linear-gradient(145deg, #f093fb, #f5576c);
    border: 2px solid #e91e63;
    color: white;
    font-family: 'Courier New', monospace;
    font-weight: bold;
}

.keyboard.retro .key:hover {
    background: linear-gradient(145deg, #f5576c, #f093fb);
    box-shadow: 0 0 10px rgba(240, 147, 251, 0.5);
}

.keyboard.retro .key.next {
    background: linear-gradient(145deg, #2196F3, #1976D2);
    color: white;
    box-shadow: 0 0 15px rgba(33, 150, 243, 0.8);
}

.keyboard.neon {
    background: #0a0a0a;
    border: 2px solid #00ffff;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
}

.keyboard.neon .key {
    background: #1a1a1a;
    border: 2px solid #00ffff;
    color: #00ffff;
    text-shadow: 0 0 10px #00ffff;
    box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
}

.keyboard.neon .key:hover {
    background: #00ffff;
    color: #000;
    text-shadow: none;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
}

.keyboard.neon .key.next {
    background: #2196F3;
    color: #000;
    border-color: #2196F3;
    box-shadow: 0 0 15px rgba(33, 150, 243, 0.8);
}

/* Settings Panel */
.settings-panel {
    position: fixed;
    top: -65vh;
    right: 0;
    width: 25vw;
    height: 65vh;
    background: var(--panel-bg);
    border-left: 2px solid var(--border-color);
    border-bottom: 2px solid var(--border-color);
    padding: 20px;
    transition: top 0.3s ease;
    z-index: 10000;
    overflow-y: auto;
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
}

.settings-panel.open {
    top: 0;
}

.settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--border-color);
}

.close-btn {
    background: var(--error-color);
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.close-btn:hover {
    background: #d32f2f;
    transform: scale(1.1);
}

.setting-group {
    margin-bottom: 20px;
    padding: 15px;
    background: var(--bg-color);
    border-radius: 5px;
    border: 1px solid var(--border-color);
}

.setting-label {
    display: block;
    margin-bottom: 10px;
    font-weight: bold;
}

.setting-input, .setting-select {
    width: 100%;
    padding: 8px;
    border: 1px solid var(--border-color);
    border-radius: 3px;
    background: var(--bg-color);
    color: var(--text-color);
}

.dashboard-access {
    width: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    font-weight: bold;
}

.dashboard-access:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.reset-btn {
    width: 100%;
    background: var(--error-color);
    color: white;
    border: none;
}

.reset-btn:hover {
    background: #d32f2f;
}

/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: flex-start;
    align-items: flex-start;
    padding: 20px;
    z-index: 10000;
}

.modal.open {
    display: flex;
}

.modal-content {
    background: var(--panel-bg);
    padding: 20px;
    border-radius: 10px;
    max-width: 80%;
    max-height: 80%;
    overflow-y: auto;
    border: 2px solid var(--border-color);
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--border-color);
}

/* Dashboard Specific Styles */
.dashboard-content {
    max-width: 90%;
    max-height: 90%;
    min-width: 800px;
    min-height: 600px;
}

.dashboard-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 10px;
}

.tab-btn {
    padding: 10px 20px;
    border: none;
    background: var(--key-bg);
    color: var(--text-color);
    border-radius: 5px 5px 0 0;
    cursor: pointer;
    transition: all 0.3s ease;
}

.tab-btn:hover {
    background: var(--key-active);
}

.tab-btn.active {
    background: var(--primary-color);
    color: white;
}

.tab-content {
    min-height: 400px;
    padding: 20px;
    background: var(--bg-color);
    border-radius: 5px;
    border: 1px solid var(--border-color);
}

/* Analytics Dashboard */
.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.analytics-card {
    padding: 20px;
    background: var(--panel-bg);
    border-radius: 10px;
    border: 1px solid var(--border-color);
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
}

.analytics-card h4 {
    margin-bottom: 15px;
    color: var(--primary-color);
}

.chart-container {
    height: 200px;
    background: var(--bg-color);
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-color);
}

.weak-keys-list {
    list-style: none;
}

.weak-keys-list li {
    padding: 8px;
    margin: 5px 0;
    background: var(--bg-color);
    border-radius: 3px;
    border-left: 4px solid var(--error-color);
}

/* Achievements */
.achievements-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
}

.achievement-card {
    padding: 15px;
    background: var(--panel-bg);
    border-radius: 10px;
    border: 1px solid var(--border-color);
    text-align: center;
    transition: all 0.3s ease;
}

.achievement-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.achievement-card.unlocked {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
}

.achievement-card.locked {
    opacity: 0.5;
    filter: grayscale(100%);
}

.achievement-icon {
    font-size: 48px;
    margin-bottom: 10px;
}

.achievement-title {
    font-weight: bold;
    margin-bottom: 5px;
}

.achievement-desc {
    font-size: 12px;
    opacity: 0.8;
}

.xp-bar {
    width: 100%;
    height: 20px;
    background: var(--border-color);
    border-radius: 10px;
    overflow: hidden;
    margin: 10px 0;
}

.xp-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #45a049);
    transition: width 0.3s ease;
}

/* Theme Builder */
.theme-builder {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.color-picker-group {
    margin-bottom: 15px;
}

.color-picker-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.color-picker-group input[type="color"] {
    width: 100%;
    height: 40px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.theme-preview {
    padding: 20px;
    border-radius: 10px;
    border: 2px solid var(--border-color);
    background: var(--panel-bg);
}

.preview-keyboard {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 2px;
    margin-top: 10px;
}

.preview-key {
    aspect-ratio: 1;
    background: var(--key-bg);
    border: 1px solid var(--key-border);
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
}

/* Help Modal Styles - Add to your styles.css */

.voice-help-modal {
    max-width: 95%;
    max-height: 95%;
    min-width: 800px;
    min-height: 600px;
}

.help-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 10px;
}

.help-tab-btn {
    padding: 10px 20px;
    border: none;
    background: var(--key-bg);
    color: var(--text-color);
    border-radius: 5px 5px 0 0;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
}

.help-tab-btn:hover {
    background: var(--key-active);
}

.help-tab-btn.active {
    background: var(--primary-color);
    color: white;
}

.help-content {
    min-height: 400px;
}

.help-tab-content {
    display: none;
    padding: 20px;
    background: var(--bg-color);
    border-radius: 5px;
    border: 1px solid var(--border-color);
    max-height: 500px;
    overflow-y: auto;
}

.help-tab-content.active {
    display: block;
}

/* Shortcuts Grid */
.shortcuts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.shortcut-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 15px;
    background: var(--panel-bg);
    border-radius: 5px;
    border-left: 4px solid var(--primary-color);
}

.shortcut-key {
    font-weight: bold;
    color: var(--primary-color);
    font-family: 'Courier New', monospace;
    background: var(--key-bg);
    padding: 2px 8px;
    border-radius: 3px;
}

.shortcut-desc {
    color: var(--text-color);
    opacity: 0.8;
}

/* Features Content */
.feature-section {
    margin-bottom: 25px;
    padding: 15px;
    background: var(--panel-bg);
    border-radius: 8px;
    border-left: 4px solid var(--secondary-color);
}

.feature-section h5 {
    color: var(--secondary-color);
    margin-bottom: 10px;
    font-size: 16px;
}

.feature-list {
    list-style: none;
    padding: 0;
}

.feature-list li {
    padding: 8px 0;
    border-bottom: 1px solid var(--border-color);
}

.feature-list li:last-child {
    border-bottom: none;
}

.feature-list strong {
    color: var(--primary-color);
}

/* Tips Content */
.tip-section {
    margin-bottom: 25px;
    padding: 15px;
    background: var(--panel-bg);
    border-radius: 8px;
    border-left: 4px solid var(--success-color);
}

.tip-section h5 {
    color: var(--success-color);
    margin-bottom: 15px;
    font-size: 16px;
}

.tip-item {
    padding: 10px;
    margin: 8px 0;
    background: var(--bg-color);
    border-radius: 5px;
    border-left: 3px solid var(--primary-color);
}

.tip-item strong {
    color: var(--primary-color);
    display: block;
    margin-bottom: 5px;
}

/* Responsive Design for Help Modal */
@media (max-width: 768px) {
    .voice-help-modal {
        min-width: 95%;
        min-height: 90%;
    }
    
    .help-tabs {
        flex-wrap: wrap;
    }
    
    .help-tab-btn {
        font-size: 12px;
        padding: 8px 12px;
    }
    
    .voice-help-content {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .shortcuts-grid {
        grid-template-columns: 1fr;
    }
    
    .shortcut-item {
        flex-direction: column;
        gap: 5px;
    }
}

/* Levels and Lessons Grid */
.levels-grid, .lessons-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.level-card, .lesson-card {
    padding: 15px;
    background: var(--bg-color);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
}

.level-card:hover, .lesson-card:hover {
    background: var(--key-active);
    transform: translateY(-2px);
}

.level-card.active, .lesson-card.active {
    background: var(--primary-color);
    color: white;
}

.custom-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
}

/* Achievement Notification */
.achievement-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    padding: 15px 20px;
    border-radius: 10px;
    box-shadow: 0 8px 32px 0 rgba(76, 175, 80, 0.37);
    display: none;
    align-items: center;
    gap: 15px;
    z-index: 10001;
    animation: slideIn 0.5s ease-out;
    max-width: 300px;
}

.achievement-notification.show {
    display: flex;
}

.achievement-notification .achievement-icon {
    font-size: 32px;
}

.achievement-notification .achievement-title {
    font-weight: bold;
    margin-bottom: 5px;
}

.achievement-notification .achievement-desc {
    font-size: 12px;
    opacity: 0.9;
}

/* Fullscreen Button */
.fullscreen-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    background: var(--secondary-color);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    z-index: 100;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.fullscreen-btn:hover {
    background: #1976D2;
    transform: scale(1.1);
}

/* Zoom Indicator */
.zoom-indicator {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(1) !important;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 20px 40px;
    border-radius: 10px;
    font-size: 24px;
    font-weight: bold;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    zoom: 100% !important;
}

.zoom-indicator.show {
    opacity: 1;
}

/* Hidden Class */
.hidden {
    display: none !important;
}

        #appWrapper.simulate-mobile {
            width: 667px;
            height: 375px;
            margin: auto;
        }
        
        #appWrapper.simulate-tablet {
            width: 1024px;
            height: 768px;
            margin: auto;
        }
        
        #appWrapper.simulate-desktop {
            width: 1366px;
            height: 768px;
            margin: auto;
        }

/* Panel Open State */
body.panel-open {
    overflow: hidden !important;
    position: fixed !important;
    width: 100vw;
    touch-action: none;
}

/* Settings Panel Override */
.settings-panel,
.modal,
.modal-content {
    transform: scale(1) !important;
    zoom: 100% !important;
    font-size: 14px !important;
    z-index: 10000 !important;
}

.settings-panel *,
.modal *,
.modal-content * {
    transform: scale(1) !important;
    zoom: 100% !important;
}

/* Container Queries for Responsive Components */
@container (min-width: 400px) {
    .analytics-card {
        grid-template-columns: 1fr 1fr;
    }
}

/* CSS Grid for Better Layouts */
.dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

/* Keyboard Shape Variations */
.keyboard.circular .key {
    border-radius: 50%;
    background: #333;
    color: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.4);
}

.keyboard.split {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
}

.keyboard.raised .key {
    background: #e0e0e0;
    border: 1px solid #999;
    box-shadow: 2px 4px 6px rgba(0,0,0,0.2);
}

.keyboard.flat .key {
    background: #f5f5f5;
    border: none;
    box-shadow: none;
}

/* Key Active State Override */
.key.active {
    background: inherit !important;
    background-color: inherit !important;
    color: inherit !important;
    box-shadow: none !important;
    border: inherit !important;
}

/* Progress Ring Animation */
.progress-ring {
    stroke-dasharray: 440;
    stroke-dashoffset: 440;
    animation: progress 2s ease-out forwards;
}

@keyframes progress {
    to {
        stroke-dashoffset: 0;
    }
}

/* AI Insights Styles */
.insights-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.insight-card {
    padding: 20px;
    background: var(--panel-bg);
    border-radius: 10px;
    border-left: 4px solid var(--primary-color);
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
}

.insight-title {
    font-weight: bold;
    color: var(--primary-color);
    margin-bottom: 10px;
}

.insight-content {
    color: var(--text-color);
    line-height: 1.6;
}

.recommendation {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    margin-top: 10px;
    font-size: 14px;
}

/* Export/Import Styles */
.export-import-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.export-card, .import-card {
    padding: 20px;
    background: var(--panel-bg);
    border-radius: 10px;
    border: 1px solid var(--border-color);
    text-align: center;
}

.export-btn, .import-btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
}

.export-btn {
    background: var(--primary-color);
    color: white;
}

.export-btn:hover {
    background: var(--primary-dark);
}

.import-btn {
    background: var(--secondary-color);
    color: white;
}

.import-btn:hover {
    background: #1976D2;
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .header {
        flex-direction: column;
        gap: 10px;
    }
    
    .stats-display {
        flex-direction: column;
        gap: 10px;
    }
    
    .keyboard {
        padding: 10px;
    }
    
    .key {
        min-width: 30px;
        height: 30px;
        font-size: 12px;
    }
    
    .settings-panel {
        width: 100%;
        right: -100%;
        transform: scale(1) !important;
        zoom: 100% !important;
    }
    
    .modal-content {
        max-width: 95%;
        max-height: 95%;
        transform: scale(1) !important;
        zoom: 100% !important;
    }
    
    .keyboard.hidden {
        display: none !important;
    }
    
    .settings-panel,
    .modal.open .modal-content {
        height: 100% !important;
        width: 100vw !important;
        max-height: none !important;
        max-width: none !important;
        overflow: auto !important;
        overscroll-behavior: contain;
        -webkit-overflow-scrolling: touch;
        touch-action: auto !important;
        box-sizing: border-box;
    }
    
    .voice-help-content {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .theme-builder {
        grid-template-columns: 1fr;
    }
    
    .analytics-grid {
        grid-template-columns: 1fr;
    }
    
    .achievements-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    
    .export-import-section {
        grid-template-columns: 1fr;
    }
    
    .dashboard-content {
        min-width: 95%;
        min-height: 90%;
    }
    
    .header-controls {
        gap: 10px;
    }
    
    .voice-btn, .help-btn, .lock-btn, .settings-btn {
        padding: 8px 12px;
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .level-selector {
        flex-direction: column;
        width: 100%;
    }
    
    .level-btn, .lesson-btn, .dashboard-btn {
        width: 100%;
        margin-bottom: 5px;
    }
    
    .header-controls {
        width: 100%;
        justify-content: space-between;
    }
    
    .stats-display {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .lesson-controls {
        flex-direction: column;
        gap: 5px;
    }
    
    .control-btn, .start-stop-btn {
        width: 100%;
    }
}

/* Print Styles */
@media print {
    .settings-panel,
    .modal,
    .fullscreen-btn,
    .zoom-indicator,
    .achievement-notification {
        display: none !important;
    }
    
    body {
        zoom: 100% !important;
    }
    
    .container {
        max-width: none;
        padding: 0;
    }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
    :root {
        --bg-color: #000000;
        --text-color: #ffffff;
        --primary-color: #00ff00;
        --secondary-color: #0080ff;
        --error-color: #ff0000;
        --key-bg: #333333;
        --key-border: #ffffff;
        --panel-bg: #111111;
        --border-color: #ffffff;
    }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* Dark Mode Auto Detection */
@media (prefers-color-scheme: dark) {
    :root {
        --bg-color: #0d1117;
        --text-color: #c9d1d9;
        --key-bg: #21262d;
        --key-border: #30363d;
        --key-active: #373e47;
        --panel-bg: #161b22;
        --border-color: #30363d;
    }
}

/* Fix for Keyboard Colors in All Shapes */

/* Circular Keys - Color Fix */
.keyboard.circular .key {
    border-radius: 50% !important;
    min-width: 45px !important;
    height: 45px !important;
    background: var(--key-bg) !important; /* Use CSS variable */
    color: var(--keyboard-text-color) !important; /* Use CSS variable */
    box-shadow: 0 2px 6px rgba(0,0,0,0.4) !important;
    border: 2px solid var(--key-border) !important;
}

.keyboard.circular .key:hover {
    background: var(--key-active) !important;
    transform: scale(1.1) !important;
}

.keyboard.circular .key.next {
    background: #4CAF50 !important;
    color: white !important;
    border: 2px solid #45a049 !important;
    box-shadow: 0 0 15px rgba(76, 175, 80, 0.8) !important;
}

/* Split Keyboard - Color Fix */
.keyboard.split {
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: space-between !important;
    gap: 20px !important;
    background: var(--panel-bg) !important;
}

.keyboard.split .key {
    background: var(--key-bg) !important;
    color: var(--keyboard-text-color) !important;
    border: 2px solid var(--key-border) !important;
}

.keyboard.split .key:hover {
    background: var(--key-active) !important;
    transform: translateY(-2px) !important;
}

.keyboard.split .key.next {
    background: #4CAF50 !important;
    color: white !important;
    border: 2px solid #45a049 !important;
    box-shadow: 0 0 10px rgba(76, 175, 80, 0.5) !important;
}

/* 3D Raised Keys - Color Fix */
.keyboard.raised {
    background: var(--panel-bg) !important;
    border: 2px solid var(--border-color) !important;
}

.keyboard.raised .key {
    background: var(--key-bg) !important;
    border: 1px solid var(--key-border) !important;
    box-shadow: 2px 4px 6px rgba(0,0,0,0.2), inset 1px 1px 2px rgba(255,255,255,0.1) !important;
    transform: perspective(100px) rotateX(5deg) !important;
    color: var(--keyboard-text-color) !important;
}

.keyboard.raised .key:hover {
    background: var(--key-active) !important;
    transform: perspective(100px) rotateX(2deg) translateY(-2px) !important;
}

.keyboard.raised .key.next {
    background: #4CAF50 !important;
    color: white !important;
    box-shadow: 2px 4px 6px rgba(0,0,0,0.3), 0 0 15px rgba(76, 175, 80, 0.8) !important;
}

/* Neon Floating Keys - Color Fix */
.keyboard.neon {
    background: #000 !important;
    border: 2px solid #0ff !important;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3) !important;
    padding: 30px !important;
}

.keyboard.neon .key {
    background: var(--key-bg) !important;
    border: 1px solid #0ff !important;
    color: var(--keyboard-text-color) !important;
    text-shadow: 0 0 10px currentColor !important;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), inset 0 0 5px rgba(0, 255, 255, 0.2) !important;
    border-radius: 8px !important;
}

.keyboard.neon .key:hover {
    background: var(--key-active) !important;
    color: var(--keyboard-text-color) !important;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.8) !important;
    transform: translateY(-3px) !important;
}

.keyboard.neon .key.next {
    background: #2196F3 !important;
    color: white !important;
    border-color: #2196F3 !important;
    box-shadow: 0 0 20px rgba(33, 150, 243, 0.8) !important;
    text-shadow: none !important;
}

/* Flat Modern Keys - Color Fix */
.keyboard.flat {
    background: var(--panel-bg) !important;
    border: none !important;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important;
    border-radius: 15px !important;
}

.keyboard.flat .key {
    background: var(--key-bg) !important;
    border: none !important;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
    border-radius: 8px !important;
    color: var(--keyboard-text-color) !important;
    font-weight: 500 !important;
}

.keyboard.flat .key:hover {
    background: var(--key-active) !important;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15) !important;
    transform: translateY(-1px) !important;
}

.keyboard.flat .key.next {
    background: #4CAF50 !important;
    color: white !important;
    box-shadow: 0 3px 10px rgba(76, 175, 80, 0.4) !important;
}
    </style>
</head>
<body data-theme="night">
    <div class="simulate-tablet" id="appWrapper">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="level-selector">
                    <button class="level-btn active" onclick="openLevelsModal()">Levels</button>
                    <button class="lesson-btn" onclick="openLessonsModal()">Lessons</button>
                    <button class="control-btn" onclick="showStats()">Stats</button>
                    <button class="dashboard-btn" onclick="openDashboard()">📊 Dashboard</button>
                </div>
                <div class="header-controls">
                    <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()">🎤</button>
                    <button class="help-btn" onclick="openVoiceHelp()">❓</button>
                    <button class="lock-btn" id="lockBtn" onclick="toggleLock()">🔓</button>
                    <button class="settings-btn" onclick="toggleSettings()">⚙️ Settings</button>
                </div>
            </div>

            <!-- Stats Display -->
            <div class="stats-display">
                <div class="stat-item">
                    <div class="stat-value" id="accuracy">100%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="speed">0</div>
                    <div class="stat-label">WPM</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="errors">0</div>
                    <div class="stat-label">Errors</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="time">0:00</div>
                    <div class="stat-label">Time</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="xp">0</div>
                    <div class="stat-label">XP</div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="lesson-progress">
                <div class="progress-track">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span class="progress-text" id="progressText">0%</span>
            </div>

            <!-- Typing Area -->
            <div class="typing-area">
                <div class="text-display" id="textDisplay">
                    <div class="text-container" id="textContainer">
                        <!-- Text will be loaded here -->
                    </div>
                </div>
                <div class="finger-hint" id="fingerHint">Position your fingers on the home row</div>
            </div>

            <!-- Lesson Controls -->
            <div class="lesson-controls">
                <button class="control-btn" onclick="restartLesson()">🔄 Restart</button>
                <button class="start-stop-btn start-btn" id="startStopBtn" onclick="toggleTyping()">▶️ Start Typing</button>
                <button class="control-btn" onclick="nextLesson()">⏭️ Next Lesson</button>
            </div>

            <!-- Keyboard -->
            <div class="keyboard touch-typing-enabled" id="keyboard">
                <!-- Keyboard will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3>Settings</h3>
            <button class="close-btn" onclick="closeSettings()">❌</button>
        </div>

        <!-- Quick Access Buttons -->
        <div class="setting-group">
            <button class="control-btn dashboard-access" onclick="openDashboard('analytics')">
                📈 Analytics Dashboard
            </button>
        </div>
        <div class="setting-group">
            <button class="control-btn dashboard-access" onclick="openDashboard('achievements')">
                🏆 Achievements
            </button>
        </div>
        <div class="setting-group">
            <button class="control-btn dashboard-access" onclick="openDashboard('themes')">
                🎨 Theme Builder
            </button>
        </div>
        <div class="setting-group">
            <button class="control-btn dashboard-access" onclick="exportProgress()">
                📤 Export Progress
            </button>
        </div>
        <div class="setting-group">
            <button class="control-btn dashboard-access" onclick="importProgress()">
                📥 Import Progress
            </button>
        </div>

        <!-- Existing Settings -->
        <div class="setting-group">
            <label class="setting-label">Theme</label>
            <select class="setting-select" id="themeSelect" onchange="changeTheme()">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option selected value="night">Night</option>
                <option value="blue">Blue</option>
                <option value="green">Green</option>
            </select>
        </div>

        <div class="setting-group">
            <label class="setting-label">Font Size</label>
            <input class="setting-input" id="fontSizeSlider" max="40" min="12" oninput="changeFontSize()" type="range" value="35"/>
            <span id="fontSizeValue">35px</span>
        </div>

        <div class="setting-group">
            <label class="setting-label">Zoom Level</label>
            <input class="setting-input" id="zoomSlider" max="200" min="50" oninput="changeZoom()" type="range" value="88"/>
            <span id="zoomValue">88%</span>
        </div>

        <div class="setting-group">
            <label class="setting-label">Device Mode</label>
            <select class="setting-select" id="deviceModeSelect" onchange="changeDeviceMode()">
                <option value="auto">Auto</option>
                <option value="mobile">Mobile</option>
                <option selected value="tablet">Tablet</option>
                <option value="desktop">Desktop</option>
            </select>
        </div>

        <div class="setting-group">
            <label class="setting-label">Keyboard Size</label>
            <input class="setting-input" id="keyboardSizeSlider" max="2" min="0.5" oninput="changeKeyboardSize()" step="0.1" type="range" value="1"/>
            <span id="keyboardSizeValue">100%</span>
        </div>

        <div class="setting-group">
            <label class="setting-label">Key Background Color</label>
            <input class="setting-input" id="keyBgColorPicker" onchange="changeKeyBackgroundColor()" type="color" value="#f0f0f0"/>
        </div>

        <div class="setting-group">
            <label class="setting-label">Keyboard Text Color</label>
            <input class="setting-input" id="keyboardTextColorPicker" onchange="changeKeyboardTextColor()" type="color" value="#000000"/>
        </div>

        <div class="setting-group">
            <label class="setting-label">Keyboard Theme</label>
            <select class="setting-select" id="keyboardThemeSelect" onchange="changeKeyboardTheme()">
                <option value="default">Default</option>
                <option value="gaming">Gaming</option>
                <option value="retro">Retro</option>
                <option value="neon">Neon</option>
            </select>
        </div>

        <div class="setting-group">
            <label class="setting-label">Keyboard Shape</label>
            <select class="setting-select" id="keyboardShapeSelect" onchange="changeKeyboardShape()">
                <option value="default">Default (Square)</option>
                <option value="circular">Circular</option>
                <option value="split">Split</option>
                <option value="raised">3D Raised</option>
                <option value="neon">Neon Floating</option>
                <option value="flat">Flat Modern</option>
            </select>
        </div>

        <div class="setting-group">
            <label class="setting-label">Show Keyboard</label>
            <select class="setting-select" id="keyboardVisibilitySelect" onchange="toggleKeyboardVisibility()">
                <option selected value="show">Show</option>
                <option value="hide">Hide</option>
            </select>
        </div>

        <div class="setting-group">
            <label class="setting-label">Mistake Sound</label>
            <select class="setting-select" id="soundSelect" onchange="changeMistakeSound()">
                <option value="sound1">Sound 1</option>
                <option value="sound2">Sound 2</option>
                <option value="sound3">Sound 3</option>
            </select>
        </div>

        <div class="setting-group">
            <label class="setting-label">Text Box Rows</label>
            <input class="setting-input" id="textBoxRowsSlider" max="5" min="1" oninput="changeTextBoxRows()" type="range" value="1"/>
            <span id="textBoxRowsValue">1 rows</span>
        </div>

        <div class="setting-group">
            <label class="setting-label">Reset Settings</label>
            <button class="control-btn reset-btn" onclick="resetAllSettings()">
                🔄 Reset All Settings to Default
            </button>
        </div>
    </div>

    <!-- All your existing modals... -->
    <!-- Dashboard Modal -->
    <div class="modal" id="dashboardModal">
        <div class="modal-content dashboard-content">
            <div class="modal-header">
                <h3>Professional Dashboard</h3>
                <button class="close-btn" onclick="closeDashboard()">×</button>
            </div>
            
            <div class="dashboard-tabs">
                <button class="tab-btn active" onclick="switchTab('analytics')">📈 Analytics</button>
                <button class="tab-btn" onclick="switchTab('achievements')">🏆 Achievements</button>
                <button class="tab-btn" onclick="switchTab('insights')">🧠 AI Insights</button>
                <button class="tab-btn" onclick="switchTab('themes')">🎨 Themes</button>
            </div>

            <div class="tab-content" id="tabContent">
                <!-- Content will be dynamically loaded -->
            </div>
        </div>
    </div>

   <!-- Updated Voice Help Modal with All Commands -->
<div class="modal" id="voiceHelpModal">
    <div class="modal-content voice-help-modal">
        <div class="modal-header">
            <h3>🎤 Voice Commands & Help Guide</h3>
            <button class="close-btn" onclick="closeVoiceHelp()">×</button>
        </div>
        
        <div class="help-tabs">
            <button class="help-tab-btn active" onclick="switchHelpTab('voice')">🎤 Voice Commands</button>
            <button class="help-tab-btn" onclick="switchHelpTab('keyboard')">⌨️ Keyboard Shortcuts</button>
            <button class="help-tab-btn" onclick="switchHelpTab('features')">🚀 Features Guide</button>
            <button class="help-tab-btn" onclick="switchHelpTab('tips')">💡 Tips & Tricks</button>
        </div>

        <div class="help-content" id="helpContent">
            <!-- Voice Commands Tab -->
            <div class="help-tab-content active" id="voiceTab">
                <div class="voice-help-content">
                    <div class="command-section">
                        <h4>🇮🇳 Hindi Commands</h4>
                        <div class="command-list">
                            <div class="command-item">
                                <span class="command">"शुरू करो"</span>
                                <span class="action">Start typing session</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"रोको"</span>
                                <span class="action">Stop typing session</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"अगला पाठ"</span>
                                <span class="action">Go to next lesson</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"रीस्टार्ट"</span>
                                <span class="action">Restart current lesson</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"सेटिंग्स खोलो"</span>
                                <span class="action">Open settings panel</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"डैशबोर्ड खोलो"</span>
                                <span class="action">Open analytics dashboard</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"लेवल खोलो"</span>
                                <span class="action">Open levels selection</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"लेसन खोलो"</span>
                                <span class="action">Open lessons selection</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"स्टेट्स दिखाओ"</span>
                                <span class="action">Show statistics</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"फुल स्क्रीन"</span>
                                <span class="action">Toggle fullscreen mode</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"लॉक करो"</span>
                                <span class="action">Lock/unlock interface</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"थीम बदलो"</span>
                                <span class="action">Change theme</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"कीबोर्ड छुपाओ"</span>
                                <span class="action">Hide virtual keyboard</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"कीबोर्ड दिखाओ"</span>
                                <span class="action">Show virtual keyboard</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"रीसेट करो"</span>
                                <span class="action">Reset all settings</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"एक्सपोर्ट करो"</span>
                                <span class="action">Export progress data</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"इम्पोर्ट करो"</span>
                                <span class="action">Import progress data</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"हेल्प खोलो"</span>
                                <span class="action">Open this help guide</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"बंद करो"</span>
                                <span class="action">Close all panels</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="command-section">
                        <h4>🇺🇸 English Commands</h4>
                        <div class="command-list">
                            <div class="command-item">
                                <span class="command">"Start typing"</span>
                                <span class="action">Begin typing session</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Stop"</span>
                                <span class="action">Pause typing session</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Next lesson"</span>
                                <span class="action">Go to next lesson</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Restart"</span>
                                <span class="action">Restart current lesson</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Open settings"</span>
                                <span class="action">Show settings panel</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Open dashboard"</span>
                                <span class="action">Show analytics dashboard</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Open levels"</span>
                                <span class="action">Show levels selection</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Open lessons"</span>
                                <span class="action">Show lessons selection</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Show stats"</span>
                                <span class="action">Display statistics</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Full screen"</span>
                                <span class="action">Toggle fullscreen</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Lock"</span>
                                <span class="action">Lock/unlock interface</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Change theme"</span>
                                <span class="action">Cycle through themes</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Hide keyboard"</span>
                                <span class="action">Hide virtual keyboard</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Show keyboard"</span>
                                <span class="action">Show virtual keyboard</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Reset"</span>
                                <span class="action">Reset all settings</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Export"</span>
                                <span class="action">Export progress</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Import"</span>
                                <span class="action">Import progress</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Help"</span>
                                <span class="action">Open help guide</span>
                            </div>
                            <div class="command-item">
                                <span class="command">"Close"</span>
                                <span class="action">Close all panels</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Keyboard Shortcuts Tab -->
            <div class="help-tab-content" id="keyboardTab">
                <div class="shortcuts-content">
                    <h4>⌨️ Keyboard Shortcuts</h4>
                    <div class="shortcuts-grid">
                        <div class="shortcut-item">
                            <span class="shortcut-key">Ctrl + 0</span>
                            <span class="shortcut-desc">Reset zoom to 110%</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Ctrl + +/-</span>
                            <span class="shortcut-desc">Zoom in/out</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Ctrl + R</span>
                            <span class="shortcut-desc">Reset zoom to 88%</span>
                        </div>
                                               <div class="shortcut-item">
                            <span class="shortcut-key">Ctrl + D</span>
                            <span class="shortcut-desc">Reset all settings</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Ctrl + C</span>
                            <span class="shortcut-desc">Close all panels</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">F11</span>
                            <span class="shortcut-desc">Toggle fullscreen</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Escape</span>
                            <span class="shortcut-desc">Exit fullscreen/Close modals</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Double Tap</span>
                            <span class="shortcut-desc">Reset zoom to 88%</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Triple Tap</span>
                            <span class="shortcut-desc">Reset zoom to 110%</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Pinch Gesture</span>
                            <span class="shortcut-desc">Zoom in/out on touch devices</span>
                        </div>
                        </div>
                        </div>
                        </div>
                        
                        <!-- Features Guide Tab -->
                        <div class="help-tab-content" id="featuresTab">
                            <div class="features-content">
                                <h4>🚀 Features Guide</h4>
                                
                                <div class="feature-section">
                                    <h5>📊 Dashboard Features</h5>
                                    <ul class="feature-list">
                                        <li><strong>Analytics:</strong> View detailed typing statistics, progress charts, and weak key analysis</li>
                                        <li><strong>Achievements:</strong> Unlock badges and track your XP/Level progression</li>
                                        <li><strong>AI Insights:</strong> Get personalized recommendations based on your typing patterns</li>
                                        <li><strong>Theme Builder:</strong> Create and customize your own themes</li>
                                    </ul>
                                </div>
                                
                                <div class="feature-section">
                                    <h5>⚙️ Settings Features</h5>
                                    <ul class="feature-list">
                                        <li><strong>Themes:</strong> Light, Dark, Night, Blue, Green themes available</li>
                                        <li><strong>Font Size:</strong> Adjustable from 12px to 40px</li>
                                        <li><strong>Zoom Level:</strong> 50% to 200% zoom support</li>
                                        <li><strong>Device Mode:</strong> Auto, Mobile, Tablet, Desktop simulation</li>
                                        <li><strong>Keyboard Customization:</strong> Size, colors, themes, shapes</li>
                                        <li><strong>Sound Effects:</strong> Multiple mistake sound options</li>
                                    </ul>
                                </div>
                                
                                <div class="feature-section">
                                    <h5>🎯 Typing Features</h5>
                                    <ul class="feature-list">
                                        <li><strong>Real-time Feedback:</strong> Instant accuracy and speed tracking</li>
                                        <li><strong>Visual Keyboard:</strong> Next key highlighting and finger hints</li>
                                        <li><strong>Progress Tracking:</strong> Lesson completion percentage</li>
                                        <li><strong>Multiple Levels:</strong> Introduction to Advanced courses</li>
                                        <li><strong>Custom Lessons:</strong> Add, edit, delete your own lessons</li>
                                        <li><strong>Y.T Course:</strong> Complete YouTube course integration</li>
                                    </ul>
                                </div>
                                
                                <div class="feature-section">
                                    <h5>🔒 Security Features</h5>
                                    <ul class="feature-list">
                                        <li><strong>Lock Mode:</strong> Prevent accidental zoom/rotation changes</li>
                                        <li><strong>Export/Import:</strong> Backup and restore your progress</li>
                                        <li><strong>Local Storage:</strong> All data saved locally on your device</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tips & Tricks Tab -->
                        <div class="help-tab-content" id="tipsTab">
                            <div class="tips-content">
                                <h4>💡 Tips & Tricks</h4>
                                
                                <div class="tip-section">
                                    <h5>🎯 Typing Tips</h5>
                                    <div class="tip-item">
                                        <strong>Proper Posture:</strong> Sit straight, feet flat on floor, wrists floating above keyboard
                                    </div>
                                    <div class="tip-item">
                                        <strong>Home Row Position:</strong> Place fingers on ASDF (left) and JKL; (right)
                                    </div>
                                    <div class="tip-item">
                                        <strong>Look at Screen:</strong> Don't look at keyboard, trust your muscle memory
                                    </div>
                                    <div class="tip-item">
                                        <strong>Accuracy First:</strong> Focus on accuracy before speed - speed will follow naturally
                                    </div>
                                    <div class="tip-item">
                                        <strong>Regular Practice:</strong> 15-30 minutes daily is better than long irregular sessions
                                    </div>
                                </div>
                                
                                <div class="tip-section">
                                    <h5>⚡ Speed Tips</h5>
                                    <div class="tip-item">
                                        <strong>Rhythm:</strong> Type in a steady rhythm, avoid bursts and pauses
                                    </div>
                                    <div class="tip-item">
                                        <strong>Word Recognition:</strong> Learn to type common words as single units
                                    </div>
                                    <div class="tip-item">
                                        <strong>Weak Keys:</strong> Use Analytics to identify and practice your weak keys
                                    </div>
                                    <div class="tip-item">
                                        <strong>Progressive Difficulty:</strong> Start with simple lessons, gradually increase complexity
                                    </div>
                                </div>
                                
                                <div class="tip-section">
                                    <h5>🛠️ App Usage Tips</h5>
                                    <div class="tip-item">
                                        <strong>Voice Commands:</strong> Use voice commands for hands-free control
                                    </div>
                                    <div class="tip-item">
                                        <strong>Custom Lessons:</strong> Create lessons with your frequently used text
                                    </div>
                                    <div class="tip-item">
                                        <strong>Theme Customization:</strong> Choose themes that are comfortable for your eyes
                                    </div>
                                    <div class="tip-item">
                                        <strong>Progress Tracking:</strong> Regular check your analytics to monitor improvement
                                    </div>
                                    <div class="tip-item">
                                        <strong>Export Progress:</strong> Backup your progress regularly
                                    </div>
                                </div>
                                
                                <div class="tip-section">
                                    <h5>🎮 Gamification Tips</h5>
                                    <div class="tip-item">
                                        <strong>Set Goals:</strong> Aim for specific WPM or accuracy targets
                                    </div>
                                    <div class="tip-item">
                                        <strong>Achievement Hunting:</strong> Try to unlock all available achievements
                                    </div>
                                    <div class="tip-item">
                                        <strong>Level Progression:</strong> Complete all lessons in order for best results
                                    </div>
                                    <div class="tip-item">
                                        <strong>Daily Practice:</strong> Maintain streaks for bonus XP and achievements
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                        </div>
                        </div>

    <!-- Levels Modal -->
    <div class="modal" id="levelsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h3>Select Level</h3>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Single-click to select, double-click to load</p>
                </div>
                <button class="close-btn" onclick="closeLevelsModal()">×</button>
            </div>
            <div class="custom-controls">
                <button class="control-btn" onclick="addCustomLevel()">Add Level</button>
                <button class="control-btn" onclick="editLevel()">Edit</button>
                <button class="control-btn" onclick="deleteLevel()">Delete</button>
                <button class="control-btn" onclick="resetLevels()">Reset</button>
            </div>
            <div class="levels-grid" id="levelsGrid"></div>
        </div>
    </div>

    <!-- Lessons Modal -->
    <div class="modal" id="lessonsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h3>Select Lesson</h3>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Single-click to select, double-click to load</p>
                </div>
                <button class="close-btn" onclick="closeLessonsModal()">×</button>
            </div>
            <div class="custom-controls">
                <button class="control-btn" onclick="addCustomLesson()">Add Lesson</button>
                <button class="control-btn" onclick="editLesson()">Edit</button>
                <button class="control-btn" onclick="deleteLesson()">Delete</button>
                <button class="control-btn" onclick="resetLessons()">Reset</button>
            </div>
            <div class="lessons-grid" id="lessonsGrid"></div>
        </div>
    </div>

    <!-- Fullscreen Button -->
    <button class="fullscreen-btn" onclick="toggleFullscreen()">⛶</button>

    <!-- Zoom Indicator -->
    <div class="zoom-indicator" id="zoomIndicator">88%</div>

    <!-- Achievement Notification -->
    <div class="achievement-notification" id="achievementNotification">
        <div class="achievement-icon">🏆</div>
        <div class="achievement-text">
            <div class="achievement-title">Achievement Unlocked!</div>
            <div class="achievement-desc">Speed Demon - 60 WPM reached!</div>
        </div>
    </div>

    <!-- Fullscreen Overlay for User Interaction -->
    <div id="fullscreenOverlay" style="position: fixed; top: 0px; left: 0px; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.9); color: white; z-index: 99999; display: flex; align-items: center; justify-content: center; font-size: 2em; flex-direction: column;">
        <div>🔠 Professional Typing Tutor</div>
        <div style="margin-top:20px;">Tap or click to start in fullscreen</div>
    </div>

    <script>
// Global variables
let currentLevel = 'introduction';
let currentLesson = 1;
let currentText = '';
let currentIndex = 0;
let startTime = null;
let errors = 0;
let correctChars = 0;
let totalChars = 0;
let isShiftPressed = false;
let timer = null;
let typingAllowed = false;

// Audio context for sounds
let audioContext = null;
let mistakeSounds = {
    sound1: null,
    sound2: null,
    sound3: null
};
let currentMistakeSound = 'sound1';
let touchTypingEnabled = true;

// Zoom functionality variables
let currentZoomLevel = 88;
let tapCount = 0;
let tapTimer = null;
let lastTouchDistance = 0;
let isZooming = false;

// Lock state variables
let isLocked = false;
let lockedZoomLevel = null;

// Voice recognition variables
let recognition = null;
let isListening = false;

// Gamification variables
let playerLevel = 1;
let playerXP = 0;
let achievements = {};

// Analytics variables
let sessionData = [];
let weakKeys = {};
let typingPatterns = {};

// Debouncing utility
const debounce = (func, wait) => {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
};

// Throttling utility
const throttle = (func, limit) => {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    }
};

// Predefined levels and lessons
const defaultLevels = {
    introduction: {
        name: 'Introduction',
        description: 'Learn the basics of touch typing'
    },
    beginner: {
        name: 'Beginner',
        description: 'Start with home row keys'
    },
    intermediate: {
        name: 'Intermediate',
        description: 'Expand to all letters'
    },
    advanced: {
        name: 'Advanced',
        description: 'Numbers and special characters'
    },
    practice: {
        name: 'Practice',
        description: 'Real-world typing practice'
    },
    'Y.T Course': {
        name: 'Y.T Course',
        description: 'YouTube Course typing lessons'
    }
};

const defaultLessons = {
    introduction: {
        1: 'fff jjj fff jjj fff jjj',
        2: 'ddd kkk ddd kkk ddd kkk',
        3: 'sss lll sss lll sss lll',
        4: 'aaa ;;; aaa ;;; aaa ;;;',
        5: 'fjdk fjdk fjdk fjdk',
        6: 'asdf jkl; asdf jkl;',
        7: 'the quick brown fox',
        8: 'jumps over the lazy dog',
        9: 'hello world typing test',
        10: 'practice makes perfect'
    },
    beginner: {
        1: 'ggg hhh ggg hhh ggg hhh',
        2: 'rrr uuu rrr uuu rrr uuu',
        3: 'eee iii eee iii eee iii',
        4: 'www ooo www ooo www ooo',
        5: 'qqq ppp qqq ppp qqq ppp',
        6: 'right hand left hand',
        7: 'finger position matters',
        8: 'keep your wrists straight',
        9: 'look at the screen not keys',
        10: 'rhythm and consistency'
    },
    intermediate: {
        1: 'ttt yyy ttt yyy ttt yyy',
        2: 'vvv nnn vvv nnn vvv nnn',
        3: 'ccc mmm ccc mmm ccc mmm',
        4: 'xxx ,,, xxx ,,, xxx ,,,',
        5: 'zzz ... zzz ... zzz ...',
        6: 'typing with all fingers',
        7: 'smooth and steady wins',
        8: 'accuracy over speed',
        9: 'build muscle memory',
        10: 'consistent practice daily'
    },
    advanced: {
        1: '111 222 333 444 555',
        2: '666 777 888 999 000',
        3: '!@# $%^ &*( )_+ {}|',
        4: 'The Quick Brown Fox',
        5: 'JUMPS OVER THE LAZY DOG',
        6: 'Numbers: 1234567890',
        7: 'Symbols: !@#$%^&*()',
        8: 'Mixed: Hello123 World!',
        9: 'Email: user@example.com',
        10: 'Code: function() { return true; }'
    },
        practice: {
        1: 'The art of typing is a skill that requires patience and practice.',
        2: 'Touch typing allows you to type without looking at the keyboard.',
        3: 'Proper finger placement on the home row is essential for speed.',
        4: 'Regular practice sessions will improve your typing accuracy.',
        5: 'Maintaining good posture while typing prevents strain and injury.',
        6: 'The quick brown fox jumps over the lazy dog near the riverbank.',
        7: 'Programming requires fast and accurate typing skills for efficiency.',
        8: 'Email communication in the modern workplace demands good typing.',
        9: 'Students who can type well have an advantage in digital learning.',
        10: 'Typing speed of 40+ WPM is considered proficient for most jobs.'
    },
    'Y.T Course': {
        'Day 1': 'asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj asdf ;lkj',
        'Day 2': 'asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfgf \';lkjhj asdfg',
        'Day 3': 'all; all; all; all; all; ash; ash; ash; ash; ash; ask; ask; ask; ask; ask; add; add; add; add; add; has; has; has; has; has; had; had; had; had; had; sad; sad; sad; sad; sad; lad; lad; lad; lad; lad; kad; kad; kad; kad; kad; lash; lash; lash; lash; lash; gas; gas; gas; gas; gas; glass; glass; glass; glass; glass; jag; jag; jag; jag; jag; fad; fad; fad; fad; fad; dad; dad; dad; dad; dad; dalda; dalda; dalda; dalda; dalda; fall; fall; fall; fall; fall; glad; glad; glad; glad; glad; flags; flags; flags; flags; flags; halda; halda; halda; halda; halda; dash; dash; dash; dash; dash; flash; flash; flash; flash; flash; lakh; lakh; lakh; lakh; lakh; flask; flask; flask; flask; flask; kajal; kajal; kajal; kajal; kajal; jakal; jakal; jakal; jakal; jakal',
        'Day 4': 'q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y q w e r  t p o i u y',
        'Day 5': 'sea sea sea sea sea fee fee fee fee fee see see see see see try try try try try hit hit hit hit hit write write write write write rat rat rat rat rat hat hat hat hat hat lot lot lot lot lot did did did did did all all all all all kid kid kid kid kid oil oil oil oil oil pot pot pot pot pot toy toy toy toy toy eat eat eat eat eat tea tea tea tea tea test test test test test sit sit sit sit sit fill fill fill fill fill pat pat pat pat pat file file file file file are are are are are out out out out out ark ark ark ark ark life life life life life pity pity pity pity pity said said said said said sad sad sad sad sad tail tail tail tail tail trial trial trial trial trial easy easy easy easy easy right right right right right height height height height height white white white white white large large large large large route route route route route early early early early early root root root root root',
        'Day 6': 'z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b z x c v /. , m n b',
        'Day 7': 'hand hand hand hand hand small small small small small chest chest chest chest chest very very very very very hen hen hen hen hen pen pen pen pen pen time time time time time around around around around around hangs hangs hangs hangs hangs lazy lazy lazy lazy lazy son son son son son net net net net net upon upon upon upon upon rights rights rights rights rights women women women women women moral moral moral moral moral bird bird bird bird bird men men men men men habit habit habit habit habit powers powers powers powers powers borrow borrow borrow borrow borrow narrow narrow narrow narrow narrow catch catch catch catch catch vens vens vens vens vens earns earns earns earns earns school school school school school college college college college college village village village village village certain certain certain certain certain curtain curtain curtain curtain curtain zebra zebra zebra zebra zebra cutter cutter cutter cutter cutter require require require require require request request request request request beside beside beside beside beside before before before before before',
        'Day 8': '1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6 1 2 3 4 5 0 9 8 7 6',
        'Day 8.1': '! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^ ! @ # $ % ) ( * & ^',
        'Day 9': 'Typing Is A Valuable Skill That Everyone Should Learn From An Early Age Whether You Are Writing Emails Reports Stories Or Even Coding The Ability To Type Fast And Accurately Can Make Your Life Easier And More Productive Each Word You Type Brings You Closer To Mastery So Keep Practicing Even If You Make Mistakes Do Not Be Discouraged Instead Use Every Error As A Learning Opportunity Stay Calm Focused And Determined To Improve With Every Session You Can Practice By Typing Meaningful Sentences Phrases And Even Creative Paragraphs That Help You Remember Proper Hand Placement And Finger Movement It May Seem Difficult At First But Over Time You Will Notice A Big Difference In Speed Confidence And Accuracy Just Remember That Practice Makes Perfect Try To Sit Comfortably With Your Feet Flat On The Floor Your Fingers Resting Lightly On The Home Row Keys And Your Eyes Focused On The Screen Not Your Keyboard This Will Train Your Muscle Memory And Help You Type Without Looking The More You Practice The Easier It Becomes Challenge Yourself By Typing Long Passages Without Pausing Or Correcting Mistakes Until The End This Will Help Build Rhythm And Endurance Over Time You Can Begin To Add Speed Tests And Try To Beat Your Own Records As You Become More Confident You Will Be Able To Handle Complex Typing Tasks With Ease Whether You Are Typing A Resume A Novel A Project Proposal Or Even A Personal Journal You Will Be Able To Complete It With Fewer Errors And Greater Efficiency Never Underestimate The Power Of A Strong Typing Foundation In A World That Relies Heavily On Digital Communication Being Able To Express Yourself Quickly And Clearly Can Give You A Huge Advantage So Keep Typing Keep Learning And Keep Pushing Forward Because You Are Capable Of Great Progress Typing Is Not Just About Speed It Is About Precision Consistency And Expression As Well When You Type With Purpose And Focus Every Word Becomes A Step Forward On Your Journey To Excellence Take Breaks When Needed Stay Hydrated And Come Back With Renewed Energy To Type Even Better Than Before Remember That Everyone Starts As A Beginner Even The Fastest Typists In The World Had To Begin With The Basics What Matters Most Is That You Keep Going Improve A Little Each Day And Stay Committed To Your Goal You Can Do This Keep Believing In Yourself And Never Stop Practicing Good Typing Skills Will Serve You For Life',
        'Day 9.1': 'Typing!Is@Essential#For$Every%Modern)User(Who*Wants&To^Work!Faster@And#More$Effectively%Each)Day(You*Practice&Typing^Improves!Your@Speed#And$Accuracy%So)Keep(Going*Even&If^You!Make@Mistakes#In$The%Beginning)Everyone(Can*Improve&Their^Typing!Skill@Set#With$Regular%Effort)Just(Remember*That&Proper^Posture!And@Focus#Lead$To%Better)Results(Over*Time&Whether^You!Are@Typing#Reports$Emails%Or)Code(Each*Keystroke&Matters^As!You@Practice#More$Often%You)Will(Notice*Big&Improvements^Soon!Always@Use#All$Fingers%Not)Just(Index(And*Thumbs&Because^That!Helps@Build#Muscle$Memory%Quickly)Try(Different*Exercises&Stay^Motivated!Use@Challenges#To$Keep%Things)Exciting(Learn*Shortcuts&Improve^Efficiency!Keep@Your#Eyes$On%The)Screen(Not*Keyboard)&Train^Your!Mind@To#Follow$The%Text)As(You*Type&Correct^Errors!Only@After#You$Finish%The)Line(So*That&You^Maintain!Speed@And#Rhythm$Throughout%Your)Session(This*Will&Help^You!Type@Like#A$Pro%In)No(Time*Just&Be^Patient!Success@Comes#With$Daily%Practice)And(Discipline*So&Never^Give!Up@Even#If$You%Feel)Tired(Keep*Trying&Push^Your!Limits@And#You$Will%Achieve)Great(Results*Every&Day^Because!Consistency@Is#Key$To%Typing)Mastery(Take*Breaks&Stretch^Often!Drink@Water#Stay$Healthy%And)Happy(While*Practicing&Let^Typing!Become@A#Part$Of%Your)Routine(So*It&Feels^Natural!Soon@You#Will$Be%Typing)Without(Looking*And&Making^Almost!No@Mistakes#At$All%You)Will(Feel*More&Confident^In!Your@Skills#And$Complete%Tasks)Faster(Than*Ever&Before^Let!Typing@Be#Your$Superpower%In)The(Digital*World&Show^Your!Talent@Through#Words$Every%Single)Day(With*Every&Effort^You!Grow@And#Master$Each%Letter)Symbol(*And&Word^)One!Step@At#A$Time%You)Are(Growing*Into&A^Typing!Champion@So#Keep$Going%And)Never(Look*Back&Always^Look!Forward@To#Improving$Even%More)Now(Get*Ready&Go^Again!',
        'Day 10': 'abcdefghijklmnopqrstuvwxyz',
        'Day 10.1': 'The quick brown fox jumps upon right over a lazy dog'
    }
};

// Finger mapping for hints
const fingerMap = {
    'q': 'left pinky', 'w': 'left ring', 'e': 'left middle', 'r': 'left index', 't': 'left index',
    'y': 'right index', 'u': 'right index', 'i': 'right middle', 'o': 'right ring', 'p': 'right pinky',
    'a': 'left pinky', 's': 'left ring', 'd': 'left middle', 'f': 'left index', 'g': 'left index',
    'h': 'right index', 'j': 'right index', 'k': 'right middle', 'l': 'right ring', ';': 'right pinky',
    'z': 'left pinky', 'x': 'left ring', 'c': 'left middle', 'v': 'left index', 'b': 'left index',
    'n': 'right index', 'm': 'right index', ',': 'right middle', '.': 'right ring', '/': 'right pinky',
    ' ': 'thumbs', '1': 'left pinky', '2': 'left ring', '3': 'left middle', '4': 'left index',
    '5': 'left index', '6': 'right index', '7': 'right index', '8': 'right middle', '9': 'right ring', '0': 'right pinky'
};

// Achievement definitions
const achievementDefinitions = {
    firstSteps: { name: "First Steps", desc: "Complete your first lesson", icon: "👶", unlocked: false },
    speedDemon: { name: "Speed Demon", desc: "Reach 60 WPM", icon: "🏎️", unlocked: false },
    perfectionist: { name: "Perfectionist", desc: "100% accuracy in a lesson", icon: "✨", unlocked: false },
    marathon: { name: "Marathon", desc: "Type for 30 minutes continuously", icon: "🏃", unlocked: false },
    nightOwl: { name: "Night Owl", desc: "Practice after midnight", icon: "🦉", unlocked: false },
    earlyBird: { name: "Early Bird", desc: "Practice before 6 AM", icon: "🐦", unlocked: false },
    streakMaster: { name: "Streak Master", desc: "Practice 7 days in a row", icon: "🔥", unlocked: false },
    keyMaster: { name: "Key Master", desc: "Master all keys", icon: "🗝️", unlocked: false }
};

// Gamification System Class
class GamificationSystem {
    constructor() {
        this.level = parseInt(localStorage.getItem('playerLevel')) || 1;
        this.xp = parseInt(localStorage.getItem('playerXP')) || 0;
        this.achievements = JSON.parse(localStorage.getItem('achievements')) || { ...achievementDefinitions };
    }

    addXP(amount) {
        this.xp += amount;
        const requiredXP = this.getRequiredXP();
        
        if (this.xp >= requiredXP) {
            this.levelUp();
        }
        
        this.updateDisplay();
        this.save();
    }

    getRequiredXP() {
        return this.level * 100;
    }

    levelUp() {
        this.level++;
        this.xp = 0;
        this.showLevelUpNotification();
    }

    showLevelUpNotification() {
        showNotification(`🎉 Level Up! You are now level ${this.level}!`, 'success');
    }

    unlockAchievement(achievementId) {
        if (!this.achievements[achievementId].unlocked) {
            this.achievements[achievementId].unlocked = true;
            this.showAchievementNotification(this.achievements[achievementId]);
            this.addXP(50); // Bonus XP for achievement
            this.save();
        }
    }

    showAchievementNotification(achievement) {
        const notification = document.getElementById('achievementNotification');
        notification.querySelector('.achievement-title').textContent = achievement.name;
        notification.querySelector('.achievement-desc').textContent = achievement.desc;
        notification.querySelector('.achievement-icon').textContent = achievement.icon;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 4000);
    }

    updateDisplay() {
        document.getElementById('level').textContent = this.level;
        document.getElementById('xp').textContent = this.xp;
    }

    save() {
        localStorage.setItem('playerLevel', this.level);
        localStorage.setItem('playerXP', this.xp);
        localStorage.setItem('achievements', JSON.stringify(this.achievements));
    }
}

// Analytics System Class
class TypingAnalytics {
    constructor() {
        this.sessions = JSON.parse(localStorage.getItem('typingSessions')) || [];
        this.weakKeys = JSON.parse(localStorage.getItem('weakKeys')) || {};
        this.patterns = JSON.parse(localStorage.getItem('typingPatterns')) || {};
    }

    recordSession(sessionData) {
        const session = {
            date: new Date().toISOString(),
            level: currentLevel,
            lesson: currentLesson,
            wpm: sessionData.wpm,
            accuracy: sessionData.accuracy,
            errors: sessionData.errors,
            time: sessionData.time,
            weakKeys: sessionData.weakKeys || []
        };
        
        this.sessions.push(session);
        this.updateWeakKeys(sessionData.weakKeys || []);
        this.save();
    }

    updateWeakKeys(keys) {
        keys.forEach(key => {
            this.weakKeys[key] = (this.weakKeys[key] || 0) + 1;
        });
    }

    getWeakestKeys(limit = 5) {
        return Object.entries(this.weakKeys)
            .sort(([,a], [,b]) => b - a)
            .slice(0, limit)
            .map(([key, count]) => ({ key, count }));
    }

    getAverageWPM() {
        if (this.sessions.length === 0) return 0;
        const total = this.sessions.reduce((sum, session) => sum + session.wpm, 0);
        return Math.round(total / this.sessions.length);
    }

    getAverageAccuracy() {
        if (this.sessions.length === 0) return 100;
        const total = this.sessions.reduce((sum, session) => sum + session.accuracy, 0);
        return Math.round(total / this.sessions.length);
    }

    getProgressData() {
        return this.sessions.slice(-10).map(session => ({
            date: new Date(session.date).toLocaleDateString(),
            wpm: session.wpm,
            accuracy: session.accuracy
        }));
    }

    generateInsights() {
        const insights = [];
        
        // WPM trend analysis
        const recentSessions = this.sessions.slice(-5);
        if (recentSessions.length >= 2) {
            const firstWPM = recentSessions[0].wpm;
            const lastWPM = recentSessions[recentSessions.length - 1].wpm;
            const improvement = lastWPM - firstWPM;
            
            if (improvement > 5) {
                insights.push({
                    type: 'positive',
                    title: 'Great Progress!',
                    content: `Your typing speed has improved by ${improvement} WPM in recent sessions.`,
                    recommendation: 'Keep up the excellent work! Consider challenging yourself with more complex texts.'
                });
            } else if (improvement < -5) {
                insights.push({
                    type: 'warning',
                    title: 'Speed Decline Detected',
                    content: `Your typing speed has decreased by ${Math.abs(improvement)} WPM recently.`,
                    recommendation: 'Take a break and focus on accuracy. Speed will naturally follow.'
                });
            }
        }

        // Accuracy analysis
        const avgAccuracy = this.getAverageAccuracy();
        if (avgAccuracy < 85) {
            insights.push({
                type: 'warning',
                title: 'Accuracy Needs Improvement',
                content: `Your average accuracy is ${avgAccuracy}%. Aim for 95%+.`,
                recommendation: 'Slow down and focus on hitting the correct keys. Accuracy is more important than speed.'
            });
        }

        // Weak keys analysis
        const weakKeys = this.getWeakestKeys(3);
        if (weakKeys.length > 0) {
            insights.push({
                type: 'info',
                title: 'Focus Areas Identified',
                content: `You struggle most with: ${weakKeys.map(k => k.key).join(', ')}`,
                recommendation: 'Practice these specific keys with targeted exercises.'
            });
        }

        return insights;
    }

    save() {
        localStorage.setItem('typingSessions', JSON.stringify(this.sessions));
        localStorage.setItem('weakKeys', JSON.stringify(this.weakKeys));
        localStorage.setItem('typingPatterns', JSON.stringify(this.patterns));
    }
}

// Theme Builder Class
class ThemeBuilder {
    constructor() {
        this.currentTheme = {
            name: "Custom Theme",
            colors: {
                primary: "#4CAF50",
                secondary: "#2196F3",
                background: "#ffffff",
                text: "#000000",
                keyBg: "#f0f0f0",
                keyBorder: "#cccccc",
                panelBg: "#f9f9f9"
            }
        };
    }

    updateColor(property, color) {
        this.currentTheme.colors[property] = color;
        this.applyTheme();
        this.updatePreview();
    }

    applyTheme() {
        const root = document.documentElement;
        const colors = this.currentTheme.colors;
        
        root.style.setProperty('--primary-color', colors.primary);
        root.style.setProperty('--secondary-color', colors.secondary);
        root.style.setProperty('--bg-color', colors.background);
        root.style.setProperty('--text-color', colors.text);
        root.style.setProperty('--key-bg', colors.keyBg);
        root.style.setProperty('--key-border', colors.keyBorder);
        root.style.setProperty('--panel-bg', colors.panelBg);
    }

    exportTheme() {
        const themeData = JSON.stringify(this.currentTheme, null, 2);
        const blob = new Blob([themeData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `${this.currentTheme.name.replace(/\s+/g, '_')}.json`;
        a.click();
        
        URL.revokeObjectURL(url);
    }

    importTheme(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const theme = JSON.parse(e.target.result);
                this.currentTheme = theme;
                this.applyTheme();
                this.updatePreview();
                showNotification('Theme imported successfully!', 'success');
            } catch (error) {
                showNotification('Invalid theme file!', 'error');
            }
        };
        reader.readAsText(file);
    }

    updatePreview() {
        const preview = document.querySelector('.theme-preview');
        if (preview) {
            preview.style.background = this.currentTheme.colors.background;
            preview.style.color = this.currentTheme.colors.text;
            
            const previewKeys = preview.querySelectorAll('.preview-key');
            previewKeys.forEach(key => {
                key.style.background = this.currentTheme.colors.keyBg;
                key.style.border = `1px solid ${this.currentTheme.colors.keyBorder}`;
            });
        }
    }
}

// Initialize systems
const gamification = new GamificationSystem();
const analytics = new TypingAnalytics();
const themeBuilder = new ThemeBuilder();

// Voice Recognition Functions
function initVoiceRecognition() {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        
        recognition.lang = 'hi-IN,en-US';
        recognition.continuous = false;
        recognition.interimResults = false;
        
        recognition.onresult = handleVoiceCommand;
        recognition.onerror = (event) => {
            console.error('Voice error:', event.error);
            updateVoiceButton(false);
        };
        
        recognition.onend = () => {
            updateVoiceButton(false);
        };
    }
}

function toggleVoiceRecognition() {
    if (!recognition) {
        initVoiceRecognition();
    }
    
    if (isListening) {
        recognition.stop();
        updateVoiceButton(false);
    } else {
        recognition.start();
        updateVoiceButton(true);
    }
}

function updateVoiceButton(listening) {
    const btn = document.getElementById('voiceBtn');
    isListening = listening;
    
    if (listening) {
        btn.classList.add('listening');
        btn.textContent = '🎙️';
    } else {
        btn.classList.remove('listening');
        btn.textContent = '🎤';
    }
}

// Updated handleVoiceCommand function with all features
function handleVoiceCommand(event) {
const command = event.results[0][0].transcript.toLowerCase();
console.log('Voice command:', command);

// Hindi Commands
if (command.includes('शुरू') || command.includes('start')) {
if (!typingAllowed) toggleTyping();
showNotification('🎤 Starting typing session', 'info');
}
else if (command.includes('रोको') || command.includes('stop')) {
if (typingAllowed) toggleTyping();
showNotification('🎤 Stopping typing session', 'info');
}
else if (command.includes('अगला') || command.includes('next')) {
nextLesson();
showNotification('🎤 Moving to next lesson', 'info');
}
else if (command.includes('रीस्टार्ट') || command.includes('restart')) {
restartLesson();
showNotification('🎤 Restarting lesson', 'info');
}
else if (command.includes('सेटिंग') || command.includes('setting')) {
toggleSettings();
showNotification('🎤 Opening settings', 'info');
}
else if (command.includes('फुल स्क्रीन') || command.includes('full screen')) {
toggleFullscreen();
showNotification('🎤 Toggling fullscreen', 'info');
}
else if (command.includes('डैशबोर्ड') || command.includes('dashboard')) {
openDashboard();
showNotification('🎤 Opening dashboard', 'info');
}
else if (command.includes('लेवल') || command.includes('level')) {
openLevelsModal();
showNotification('🎤 Opening levels', 'info');
}
else if (command.includes('लेसन') || command.includes('lesson')) {
openLessonsModal();
showNotification('🎤 Opening lessons', 'info');
}
else if (command.includes('स्टेट्स') || command.includes('stats')) {
showStats();
showNotification('🎤 Showing statistics', 'info');
}
else if (command.includes('लॉक') || command.includes('lock')) {
toggleLock();
showNotification('🎤 Toggling lock', 'info');
}
else if (command.includes('थीम') || command.includes('theme')) {
// Cycle through themes
const themes = ['light', 'dark', 'night', 'blue', 'green'];
const currentTheme = document.body.getAttribute('data-theme');
const currentIndex = themes.indexOf(currentTheme);
const nextTheme = themes[(currentIndex + 1) % themes.length];
document.body.setAttribute('data-theme', nextTheme);
document.getElementById('themeSelect').value = nextTheme;
showNotification(`🎤 Theme changed to: ${nextTheme}`, 'info');
}
else if (command.includes('कीबोर्ड छुपाओ') || command.includes('hide keyboard')) {
document.getElementById('keyboardVisibilitySelect').value = 'hide';
toggleKeyboardVisibility();
showNotification('🎤 Keyboard hidden', 'info');
}
else if (command.includes('कीबोर्ड दिखाओ') || command.includes('show keyboard')) {
document.getElementById('keyboardVisibilitySelect').value = 'show';
toggleKeyboardVisibility();
showNotification('🎤 Keyboard shown', 'info');
}
else if (command.includes('रीसेट') || command.includes('reset')) {
resetAllSettings();
showNotification('🎤 Settings reset', 'info');
}
else if (command.includes('एक्सपोर्ट') || command.includes('export')) {
exportProgress();
showNotification('🎤 Exporting progress', 'info');
}
else if (command.includes('इम्पोर्ट') || command.includes('import')) {
importProgress();
showNotification('🎤 Import progress dialog opened', 'info');
}
else if (command.includes('हेल्प') || command.includes('help')) {
openVoiceHelp();
showNotification('🎤 Opening help', 'info');
}
else if (command.includes('बंद करो') || command.includes('close')) {
// Close any open modals/panels
closeSettings();
closeDashboard();
closeLevelsModal();
closeLessonsModal();
closeVoiceHelp();
showNotification('🎤 Closing panels', 'info');
}
else {
showNotification('🎤 Command not recognized. Say "help" for available commands.', 'warning');
}

updateVoiceButton(false);
}

// Dashboard Functions
function openDashboard(tab = 'analytics') {
    document.getElementById('dashboardModal').classList.add('open');
    document.body.classList.add('panel-open');
    switchTab(tab);
}

function closeDashboard() {
    document.getElementById('dashboardModal').classList.remove('open');
    document.body.classList.remove('panel-open');
}

function switchTab(tabName) {
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event?.target?.classList.add('active') || 
    document.querySelector(`[onclick="switchTab('${tabName}')"]`)?.classList.add('active');
    
    // Update content
    const content = document.getElementById('tabContent');
    
    switch(tabName) {
        case 'analytics':
            content.innerHTML = generateAnalyticsContent();
            break;
        case 'achievements':
            content.innerHTML = generateAchievementsContent();
            break;
        case 'insights':
            content.innerHTML = generateInsightsContent();
            break;
        case 'themes':
            content.innerHTML = generateThemesContent();
            break;
    }
}

function generateAnalyticsContent() {
    const avgWPM = analytics.getAverageWPM();
    const avgAccuracy = analytics.getAverageAccuracy();
    const weakKeys = analytics.getWeakestKeys();
    const progressData = analytics.getProgressData();
    
    return `
        <div class="analytics-grid">
            <div class="analytics-card">
                <h4>📊 Overall Statistics</h4>
                <div class="stat-row">
                    <span>Average WPM:</span>
                    <strong>${avgWPM}</strong>
                </div>
                <div class="stat-row">
                    <span>Average Accuracy:</span>
                    <strong>${avgAccuracy}%</strong>
                </div>
                <div class="stat-row">
                    <span>Total Sessions:</span>
                    <strong>${analytics.sessions.length}</strong>
                </div>
            </div>
            
            <div class="analytics-card">
                <h4>📈 Progress Chart</h4>
                <div class="chart-container">
                    <canvas id="progressChart" width="300" height="150"></canvas>
                </div>
            </div>
            
            <div class="analytics-card">
                <h4>⚠️ Weak Keys</h4>
                <ul class="weak-keys-list">
                    ${weakKeys.map(item => 
                        `<li>${item.key}: ${item.count} errors</li>`
                    ).join('')}
                </ul>
            </div>
            
            <div class="analytics-card">
                <h4>📅 Recent Sessions</h4>
                <div class="sessions-list">
                    ${progressData.slice(-5).map(session => 
                        `<div class="session-item">
                            <span>${session.date}</span>
                            <span>${session.wpm} WPM</span>
                            <span>${session.accuracy}%</span>
                        </div>`
                    ).join('')}
                </div>
            </div>
        </div>
    `;
}

function generateAchievementsContent() {
    const achievements = gamification.achievements;
    const unlockedCount = Object.values(achievements).filter(a => a.unlocked).length;
    const totalCount = Object.keys(achievements).length;
    const progressPercent = Math.round((unlockedCount / totalCount) * 100);
    
    return `
        <div class="achievements-header">
            <h4>🏆 Achievements Progress: ${unlockedCount}/${totalCount} (${progressPercent}%)</h4>
            <div class="xp-bar">
                <div class="xp-fill" style="width: ${progressPercent}%"></div>
            </div>
        </div>
        
        <div class="achievements-grid">
            ${Object.entries(achievements).map(([id, achievement]) => `
                <div class="achievement-card ${achievement.unlocked ? 'unlocked' : 'locked'}">
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-title">${achievement.name}</div>
                    <div class="achievement-desc">${achievement.desc}</div>
                    ${achievement.unlocked ? '<div class="achievement-status">✅ Unlocked</div>' : '<div class="achievement-status">🔒 Locked</div>'}
                </div>
            `).join('')}
        </div>
    `;
}

function generateInsightsContent() {
    const insights = analytics.generateInsights();
    
    return `
        <div class="insights-container">
            <h4>🧠 AI-Powered Insights</h4>
            ${insights.length > 0 ? insights.map(insight => `
                <div class="insight-card">
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-content">${insight.content}</div>
                    <div class="recommendation">${insight.recommendation}</div>
                </div>
            `).join('') : '<p>Complete more lessons to get personalized insights!</p>'}
        </div>
    `;
}

function generateThemesContent() {
    return `
        <div class="theme-builder">
            <div class="theme-controls">
                <h4>🎨 Custom Theme Builder</h4>
                
                <div class="color-picker-group">
                    <label>Primary Color:</label>
                    <input type="color" value="#4CAF50" onchange="themeBuilder.updateColor('primary', this.value)">
                </div>
                
                <div class="color-picker-group">
                    <label>Secondary Color:</label>
                    <input type="color" value="#2196F3" onchange="themeBuilder.updateColor('secondary', this.value)">
                </div>
                
                <div class="color-picker-group">
                    <label>Background Color:</label>
                    <input type="color" value="#ffffff" onchange="themeBuilder.updateColor('background', this.value)">
                </div>
                
                <div class="color-picker-group">
                    <label>Text Color:</label>
                    <input type="color" value="#000000" onchange="themeBuilder.updateColor('text', this.value)">
                </div>
                
                <div class="color-picker-group">
                    <label>Key Background:</label>
                    <input type="color" value="#f0f0f0" onchange="themeBuilder.updateColor('keyBg', this.value)">
                </div>
                
                <div class="theme-actions">
                    <button class="control-btn" onclick="themeBuilder.exportTheme()">📤 Export Theme</button>
                    <input type="file" id="themeImport" accept=".json" onchange="themeBuilder.importTheme(this.files[0])" style="display: none;">
                    <button class="control-btn" onclick="document.getElementById('themeImport').click()">📥 Import Theme</button>
                </div>
            </div>
            
            <div class="theme-preview">
                <h4>Preview</h4>
                <div class="preview-text">Sample typing text</div>
                <div class="preview-keyboard">
                    ${Array.from({length: 26}, (_, i) => 
                        `<div class="preview-key">${String.fromCharCode(65 + i)}</div>`
                    ).join('')}
                </div>
            </div>
        </div>
    `;
}

// Voice Help Functions
function openVoiceHelp() {
    document.getElementById('voiceHelpModal').classList.add('open');
    document.body.classList.add('panel-open');
}

function closeVoiceHelp() {
    document.getElementById('voiceHelpModal').classList.remove('open');
    document.body.classList.remove('panel-open');
}

// Export/Import Progress Functions
function exportProgress() {
    const data = {
        stats: localStorage.getItem('lessonStats'),
        settings: {
            theme: localStorage.getItem('theme'),
            fontSize: localStorage.getItem('fontSize'),
            zoom: localStorage.getItem('zoom'),
            keyboardSize: localStorage.getItem('keyboardSize'),
            mistakeSound: localStorage.getItem('mistakeSound'),
            textBoxRows: localStorage.getItem('textBoxRows'),
            keyboardTheme: localStorage.getItem('keyboardTheme'),
            keyboardVisibility: localStorage.getItem('keyboardVisibility'),
            keyBgColor: localStorage.getItem('keyBgColor'),
            keyboardTextColor: localStorage.getItem('keyboardTextColor')
        },
        achievements: localStorage.getItem('achievements'),
        analytics: {
            sessions: localStorage.getItem('typingSessions'),
            weakKeys: localStorage.getItem('weakKeys'),
            patterns: localStorage.getItem('typingPatterns')
        },
        gamification: {
            level: localStorage.getItem('playerLevel'),
            xp: localStorage.getItem('playerXP')
        },
        customContent: {
            levels: localStorage.getItem('customLevels'),
            lessons: localStorage.getItem('customLessons')
        },
        exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `typing-progress-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    
    URL.revokeObjectURL(url);
    showNotification('📤 Progress exported successfully!', 'success');
}

function importProgress() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const data = JSON.parse(event.target.result);
                
                // Restore all data
                if (data.stats) localStorage.setItem('lessonStats', data.stats);
                if (data.settings) {
                    Object.entries(data.settings).forEach(([key, value]) => {
                        if (value !== null) localStorage.setItem(key, value);
                    });
                }
                if (data.achievements) localStorage.setItem('achievements', data.achievements);
                if (data.analytics) {
                    Object.entries(data.analytics).forEach(([key, value]) => {
                        if (value !== null) localStorage.setItem(key, value);
                    });
                }
                if (data.gamification) {
                    Object.entries(data.gamification).forEach(([key, value]) => {
                        if (value !== null) localStorage.setItem(key, value);
                    });
                }
                if (data.customContent) {
                    Object.entries(data.customContent).forEach(([key, value]) => {
                        if (value !== null) localStorage.setItem(key, value);
                    });
                }
                
                // Reload the application
                location.reload();
                
            } catch (error) {
                showNotification('❌ Invalid progress file!', 'error');
            }
        };
        reader.readAsText(file);
    };
    
    input.click();
}

// Notification System
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        z-index: 10001;
        animation: slideIn 0.3s ease-out;
        max-width: 300px;
        word-wrap: break-word;
    `;
    
    switch(type) {
        case 'success':
            notification.style.background = '#4CAF50';
            break;
        case 'error':
            notification.style.background = '#f44336';
            break;
        case 'warning':
            notification.style.background = '#FF9800';
            break;
        default:
            notification.style.background = '#2196F3';
    }
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Zoom functionality
function updateZoomLevel(newZoom) {
    if (isLocked) {
        showNotification('🔒 Zoom is locked!', 'warning');
        return;
    }
    
    currentZoomLevel = Math.max(50, Math.min(200, newZoom));
    document.body.style.zoom = currentZoomLevel + '%';
    
    const zoomSlider = document.getElementById('zoomSlider');
    const zoomValue = document.getElementById('zoomValue');
    if (zoomSlider && zoomValue) {
        zoomSlider.value = currentZoomLevel;
        zoomValue.textContent = currentZoomLevel + '%';
    }
    
    showZoomIndicator();
    localStorage.setItem('zoom', currentZoomLevel);
}

function showZoomIndicator() {
    const indicator = document.getElementById('zoomIndicator');
    indicator.textContent = currentZoomLevel + '%';
    indicator.classList.add('show');
    
    setTimeout(() => {
        indicator.classList.remove('show');
    }, 1000);
}

// Lock functionality
function toggleLock() {
    const lockBtn = document.getElementById('lockBtn');
    
    if (!isLocked) {
        isLocked = true;
        lockedZoomLevel = currentZoomLevel;
        lockBtn.textContent = '🔒';
        lockBtn.classList.add('locked');
        
        if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('portrait').catch(() => {
                console.log('Screen rotation lock not supported');
            });
        }
        
        disableZoomControls();
        showLockFeedback('🔒 Locked: Zoom & Rotation');
        
    } else {
        isLocked = false;
        lockedZoomLevel = null;
        lockBtn.textContent = '🔓';
        lockBtn.classList.remove('locked');
        
        if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock();
        }
        
        enableZoomControls();
        showLockFeedback('🔓 Unlocked: Zoom & Rotation');
    }
}

function disableZoomControls() {
    document.removeEventListener('wheel', handleWheel);
    document.removeEventListener('touchstart', handleTouchStart);
    document.removeEventListener('touchmove', handleTouchMove);
    document.removeEventListener('touchend', handleTouchEnd);
}

function enableZoomControls() {
    document.addEventListener('wheel', handleWheel, { passive: false });
    document.addEventListener('touchstart', handleTouchStart, { passive: false });
    document.addEventListener('touchmove', handleTouchMove, { passive: false });
    document.addEventListener('touchend', handleTouchEnd, { passive: false });
}

function showLockFeedback(message) {
    const feedback = document.createElement('div');
    feedback.textContent = message;
    feedback.style.cssText = `
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: rgba(255, 87, 34, 0.9); color: white; padding: 15px 25px;
        border-radius: 10px; z-index: 9999; font-weight: bold; font-size: 18px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    `;
    document.body.appendChild(feedback);
    setTimeout(() => feedback.remove(), 2000);
}

// Touch and gesture handling
function handleSmartTap(event) {
    if (isLocked) return;
    
    const isAllowedArea = event.target === document.body ||
        event.target.classList.contains('container') ||
        event.target.classList.contains('text-display') ||
        event.target.classList.contains('text-container') ||
        event.target.classList.contains('stats-display') ||
        event.target.classList.contains('stat-item') ||
        event.target.classList.contains('stat-value') ||
        event.target.classList.contains('stat-label');
    
    const isExcludedElement = event.target.closest('.keyboard') ||
        event.target.closest('.key') ||
        event.target.closest('.settings-panel') ||
        event.target.closest('.modal') ||
        event.target.closest('button') ||
        event.target.closest('input') ||
        event.target.closest('select');
    
    if (isAllowedArea && !isExcludedElement) {
        tapCount++;
        
        if (tapCount === 1) {
            tapTimer = setTimeout(() => {
                tapCount = 0;
            }, 600);
            
        } else if (tapCount === 2) {
            setTimeout(() => {
                if (tapCount === 2) {
                    clearTimeout(tapTimer);
                    tapCount = 0;
                    updateZoomLevel(88);
                    event.preventDefault();
                    showNotification('👆👆 Double Tap - Zoom Reset to 88%!', 'info');
                }
            }, 300);
            
        } else if (tapCount === 3) {
            clearTimeout(tapTimer);
            tapCount = 0;
            updateZoomLevel(110);
            event.preventDefault();
            showNotification('👆👆👆 Triple Tap - Zoom Reset to 110%!', 'success');
            
        } else {
            clearTimeout(tapTimer);
            tapCount = 0;
        }
    }
}

function getTouchDistance(touches) {
    const dx = touches[0].clientX - touches[1].clientX;
    const dy = touches[0].clientY - touches[1].clientY;
    return Math.sqrt(dx * dx + dy * dy);
}

function handleTouchStart(event) {
    if (isLocked) return;
    
    if (event.touches.length === 2) {
        lastTouchDistance = getTouchDistance(event.touches);
        isZooming = true;
        event.preventDefault();
    } else if (event.touches.length === 1) {
        handleSmartTap(event);
    }
}

function handleTouchMove(event) {
    if (isLocked) return;
    
    if (event.touches.length === 2 && isZooming) {
        const currentDistance = getTouchDistance(event.touches);
        const scale = currentDistance / lastTouchDistance;
        
        if (Math.abs(scale - 1) > 0.01) {
            const zoomChange = (scale - 1) * 50;
            updateZoomLevel(currentZoomLevel + zoomChange);
            lastTouchDistance = currentDistance;
        }
        
        event.preventDefault();
    }
}

function handleTouchEnd(event) {
    if (event.touches.length < 2) {
        isZooming = false;
    }
}

function handleWheel(event) {
    if (isLocked) return;
    
    if (event.ctrlKey) {
        event.preventDefault();
        const zoomChange = event.deltaY > 0 ? -10 : 10;
        updateZoomLevel(currentZoomLevel + zoomChange);
    }
}

// Create virtual keyboard
function createKeyboard() {
    const keyboard = document.getElementById('keyboard');
    const rows = [
        ['`', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '-', '=', 'backspace'],
        ['tab', 'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', '[', ']', '\\'],
        ['caps', 'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';', "'", 'enter'],
        ['shift', 'z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/', 'shift'],
        ['ctrl', 'alt', 'space', 'alt', 'ctrl']
    ];
    
    keyboard.innerHTML = '';
    rows.forEach(row => {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'keyboard-row';
        
        row.forEach(key => {
            const keyDiv = document.createElement('div');
            keyDiv.className = `key ${key}`;
            keyDiv.setAttribute('data-key', key);
            
            if (key === 'space') {
                keyDiv.textContent = '';
                keyDiv.className += ' space';
            } else if (key === 'backspace') {
                keyDiv.textContent = '⌫';
                keyDiv.className += ' backspace';
            } else if (key === 'enter') {
                keyDiv.textContent = '↵';
                keyDiv.className += ' enter';
            } else if (key === 'shift') {
                keyDiv.textContent = '⇧';
                keyDiv.className += ' shift';
            } else if (key === 'tab') {
                keyDiv.textContent = '⇥';
                keyDiv.className += ' tab';
            } else if (key === 'caps') {
                keyDiv.textContent = '⇪';
                keyDiv.className += ' caps';
            } else if (key === 'ctrl') {
                keyDiv.textContent = 'Ctrl';
                keyDiv.className += ' ctrl';
            } else if (key === 'alt') {
                keyDiv.textContent = 'Alt';
                keyDiv.className += ' alt';
            } else {
                keyDiv.textContent = key;
            }
            
            rowDiv.appendChild(keyDiv);
        });
        
        keyboard.appendChild(rowDiv);
    });
}

// Handle key press
function handleKeyDown(event) {
    if (!typingAllowed) {
        event.preventDefault();
        return;
    }
    
    const key = event.key;
    const keyCode = event.keyCode;
    
    if (key === 'Shift') {
        isShiftPressed = true;
        updateKeyboardShift();
        return;
    }
    
    if (keyCode >= 32 && keyCode <= 126) {
        event.preventDefault();
    }
    
    processTypedCharacter(key);
}

function handleKeyUp(event) {
    const key = event.key;
    
    if (key === 'Shift') {
        isShiftPressed = false;
        updateKeyboardShift();
    }
}

// Update keyboard display for shift state
function updateKeyboardShift() {
    const keys = document.querySelectorAll('.key');
    keys.forEach(key => {
        const keyData = key.getAttribute('data-key');
        if (isShiftPressed) {
            const shiftMap = {
                '1': '!', '2': '@', '3': '#', '4': '$', '5': '%',
                '6': '^', '7': '&', '8': '*', '9': '(', '0': ')',
                '-': '_', '=': '+', '[': '{', ']': '}', '\\': '|',
                ';': ':', "'": '"', ',': '<', '.': '>', '/': '?', '`': '~'
            };
            
            if (shiftMap[keyData]) {
                key.textContent = shiftMap[keyData];
            } else if (keyData.length === 1 && keyData.match(/[a-z]/)) {
                key.textContent = keyData.toUpperCase();
            }
        } else {
            // Reset to normal state
            if (keyData === 'space') key.textContent = '';
            else if (keyData === 'backspace') key.textContent = '⌫';
            else if (keyData === 'enter') key.textContent = '↵';
            else if (keyData === 'shift') key.textContent = '⇧';
            else if (keyData === 'tab') key.textContent = '⇥';
            else if (keyData === 'caps') key.textContent = '⇪';
            else if (keyData === 'ctrl') key.textContent = 'Ctrl';
            else if (keyData === 'alt') key.textContent = 'Alt';
            else key.textContent = keyData;
        }
    });
}

function processTypedCharacter(key) {
    if (!typingAllowed) return;
    if (currentIndex >= currentText.length) return;
    
    const expectedChar = currentText[currentIndex];
    const typedChar = key;
    
    if (startTime === null) {
        startTime = Date.now();
        startTimer();
    }
    
    const charElement = document.querySelector(`[data-index="${currentIndex}"]`);
    
    if (typedChar === expectedChar) {
        charElement.classList.remove('current', 'upcoming');
        charElement.classList.add('correct');
        correctChars++;
        currentIndex++;
        
        // Add XP for correct character
        gamification.addXP(1);
        
        updateCurrentCharacterHighlight();
        updateScrollPosition();
        updateNextCharacterHighlight();
        updateFingerHint();
        updateProgress();
        
        if (currentIndex >= currentText.length) {
            completeLesson();
        }
    } else {
        charElement.classList.remove('current', 'upcoming');
        charElement.classList.add('incorrect');
        errors++;
        
        // Track weak keys
        if (!weakKeys[expectedChar]) weakKeys[expectedChar] = 0;
        weakKeys[expectedChar]++;
        
        playMistakeSound();
        currentIndex++;
        
        updateCurrentCharacterHighlight();
        updateScrollPosition();
        updateNextCharacterHighlight();
        updateFingerHint();
        updateProgress();
        
        if (currentIndex >= currentText.length) {
            completeLesson();
        }
    }
    
    totalChars++;
    updateStats();
}

// Update progress bar
function updateProgress() {
    const progressPercent = Math.round((currentIndex / currentText.length) * 100);
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    
    if (progressFill && progressText) {
        progressFill.style.width = progressPercent + '%';
        progressText.textContent = progressPercent + '%';
    }
}

// Update current character highlight
function updateCurrentCharacterHighlight() {
    document.querySelectorAll('.char.current').forEach(char => {
        char.classList.remove('current');
        if (parseInt(char.getAttribute('data-index')) > currentIndex) {
            char.classList.add('upcoming');
        }
    });
    
    if (currentIndex < currentText.length) {
        const currentChar = document.querySelector(`[data-index="${currentIndex}"]`);
        if (currentChar) {
            currentChar.classList.remove('upcoming');
            currentChar.classList.add('current');
        }
    }
}

// Update scroll position
function updateScrollPosition() {
    const textContainer = document.getElementById('textContainer');
    const textDisplay = document.getElementById('textDisplay');
    
    if (!textContainer || !textDisplay) return;
    
    const charWidth = parseFloat(getComputedStyle(textDisplay).fontSize) * 0.6;
    const containerWidth = textDisplay.clientWidth;
    const centerPosition = containerWidth / 2;
    const scrollOffset = (currentIndex * charWidth) - centerPosition + (charWidth / 2);
    
    textContainer.style.transform = `translateX(-${Math.max(0, scrollOffset)}px)`;
}

// Update next character highlight on keyboard
function updateNextCharacterHighlight() {
    document.querySelectorAll('.key.next').forEach(key => {
        key.classList.remove('next');
    });
    
    if (currentIndex < currentText.length) {
        const nextChar = currentText[currentIndex];
        let keyToHighlight = nextChar.toLowerCase();
        
        if (nextChar === ' ') {
            keyToHighlight = 'space';
        } else if (nextChar.match(/[A-Z]/)) {
            keyToHighlight = nextChar.toLowerCase();
            document.querySelectorAll('[data-key="shift"]').forEach(key => {
                key.classList.add('next');
            });
        } else if ('!@#$%^&*()_+{}|:"<>?~'.includes(nextChar)) {
            const shiftMap = {
                '!': '1', '@': '2', '#': '3', '$': '4', '%': '5',
                '^': '6', '&': '7', '*': '8', '(': '9', ')': '0',
                '_': '-', '+': '=', '{': '[', '}': ']', '|': '\\',
                ':': ';', '"': "'", '<': ',', '>': '.', '?': '/', '~': '`'
            };
            keyToHighlight = shiftMap[nextChar] || nextChar;
            document.querySelectorAll('[data-key="shift"]').forEach(key => {
                key.classList.add('next');
            });
        }
        
        const keyElement = document.querySelector(`[data-key="${keyToHighlight}"]`);
        if (keyElement) {
            keyElement.classList.add('next');
        }
    }
}

// Update finger hint
function updateFingerHint() {
    const fingerHint = document.getElementById('fingerHint');
    
    if (currentIndex < currentText.length) {
        const nextChar = currentText[currentIndex].toLowerCase();
        const finger = fingerMap[nextChar] || 'appropriate finger';
        const charDisplay = currentText[currentIndex] === ' ' ? 'space' : currentText[currentIndex];
        
        let hint = `Next: "${charDisplay}" - Use ${finger}`;
        
        if (currentText[currentIndex].match(/[A-Z]/) || '!@#$%^&*()_+{}|:"<>?~'.includes(currentText[currentIndex])) {
            hint += ' (with Shift)';
        }
        
        fingerHint.textContent = hint;
    } else {
        fingerHint.textContent = 'Lesson complete!';
    }
}

function loadLesson() {
    const levels = JSON.parse(localStorage.getItem('customLevels')) || defaultLevels;
    const lessons = JSON.parse(localStorage.getItem('customLessons')) || defaultLessons;
    
    currentText = lessons[currentLevel]?.[currentLesson] || 'Sample text for typing practice.';
    currentIndex = 0;
    errors = 0;
    correctChars = 0;
    totalChars = 0;
    startTime = null;
    weakKeys = {};
    
    if (timer) {
        clearInterval(timer);
        timer = null;
    }
    
    displayText();
    updateStats();
    updateProgress();
    
    if (typingAllowed) {
        updateNextCharacterHighlight();
        updateFingerHint();
    }
}

// Display text with character spans
function displayText() {
    const textDisplay = document.getElementById('textDisplay');
    textDisplay.innerHTML = '';
    
    const textContainer = document.createElement('div');
    textContainer.className = 'text-container';
    textContainer.id = 'textContainer';
    
    for (let i = 0; i < currentText.length; i++) {
        const span = document.createElement('span');
        span.className = 'char';
        span.setAttribute('data-index', i);
        span.textContent = currentText[i];
        
        if (i === currentIndex) {
            span.classList.add('current');
        } else if (i > currentIndex) {
            span.classList.add('upcoming');
        }
        
        textContainer.appendChild(span);
    }
    
    textDisplay.appendChild(textContainer);
    
    setTimeout(() => {
        updateScrollPosition();
    }, 50);
}

// Update statistics
function updateStats() {
    const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
    const timeElapsed = startTime ? (Date.now() - startTime) / 1000 : 0;
    const wpm = timeElapsed > 0 ? Math.round((correctChars / 5) / (timeElapsed / 60)) : 0;
    
    document.getElementById('accuracy').textContent = accuracy + '%';
    document.getElementById('speed').textContent = wpm;
    document.getElementById('errors').textContent = errors;
    
    // Check for achievements
    if (wpm >= 60 && !gamification.achievements.speedDemon.unlocked) {
        gamification.unlockAchievement('speedDemon');
    }
    
    if (accuracy === 100 && totalChars > 10 && !gamification.achievements.perfectionist.unlocked) {
        gamification.unlockAchievement('perfectionist');
    }
}

// Start timer
function startTimer() {
    timer = setInterval(() => {
        if (startTime) {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('time').textContent =
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Check for marathon achievement
            if (elapsed >= 1800 && !gamification.achievements.marathon.unlocked) { // 30 minutes
                gamification.unlockAchievement('marathon');
            }
        }
    }, 1000);
}

// Complete lesson
function completeLesson() {
    if (timer) {
        clearInterval(timer);
        timer = null;
    }
    
    // Record session data
    const timeElapsed = startTime ? (Date.now() - startTime) / 1000 : 0;
    const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
    const wpm = timeElapsed > 0 ? Math.round((correctChars / 5) / (timeElapsed / 60)) : 0;
    
    const sessionData = {
        wpm: wpm,
        accuracy: accuracy,
        errors: errors,
        time: timeElapsed,
        weakKeys: Object.keys(weakKeys)
    };
    
    analytics.recordSession(sessionData);
    gamification.addXP(Math.round(wpm + accuracy));
    
    // Check for first lesson achievement
    if (!gamification.achievements.firstSteps.unlocked) {
        gamification.unlockAchievement('firstSteps');
    }
    
    saveLessonStats();
    
    setTimeout(() => {
        showNotification('🎉 Lesson completed! Great job!', 'success');
    }, 500);
}

// Save lesson statistics
function saveLessonStats() {
    const stats = JSON.parse(localStorage.getItem('lessonStats')) || {};
    const key = `${currentLevel}-${currentLesson}`;
    
    const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
    const timeElapsed = startTime ? (Date.now() - startTime) / 1000 : 0;
    const wpm = timeElapsed > 0 ? Math.round((correctChars / 5) / (timeElapsed / 60)) : 0;
    
    stats[key] = {
        accuracy,
        wpm,
        errors,
        time: timeElapsed,
        date: new Date().toISOString()
    };
    
    localStorage.setItem('lessonStats', JSON.stringify(stats));
}

// Generate mistake sounds
function generateMistakeSounds() {
    try {
        const context = new(window.AudioContext || window.webkitAudioContext)();
        const frequencies = [800, 600, 400];
        
        frequencies.forEach((freq, index) => {
            const soundKey = `sound${index + 1}`;
            mistakeSounds[soundKey] = () => {
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.frequency.setValueAtTime(freq, context.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.2);
                
                oscillator.start(context.currentTime);
                oscillator.stop(context.currentTime + 0.2);
            };
        });
    } catch (error) {
        console.log('Audio context not available');
    }
}

// Play mistake sound
function playMistakeSound() {
    if (mistakeSounds[currentMistakeSound]) {
        mistakeSounds[currentMistakeSound]();
    }
}

// Settings functions
function toggleSettings() {
    const panel = document.getElementById('settingsPanel');
    panel.classList.toggle('open');
    if (panel.classList.contains('open')) {
        document.body.classList.add('panel-open');
    } else {
        document.body.classList.remove('panel-open');
    }
}

function closeSettings() {
    const panel = document.getElementById('settingsPanel');
    panel.classList.remove('open');
    document.body.classList.remove('panel-open');
}

function changeTheme() {
    const theme = document.getElementById('themeSelect').value;
    document.body.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
}

function changeFontSize() {
    const size = document.getElementById('fontSizeSlider').value;
    document.getElementById('fontSizeValue').textContent = size + 'px';
    document.getElementById('textDisplay').style.fontSize = size + 'px';
    localStorage.setItem('fontSize', size);
}

// Updated changeKeyBackgroundColor function
function changeKeyBackgroundColor() {
    const color = document.getElementById('keyBgColorPicker').value;
    
    // Method 1: Update CSS variable
    document.documentElement.style.setProperty('--key-bg', color);
    
    // Method 2: Force update all keys immediately (including shaped keyboards)
    const updateKeys = () => {
        document.querySelectorAll('.key').forEach(key => {
            if (!key.classList.contains('next')) {
                key.style.backgroundColor = color + ' !important';
            }
        });
    };
    
    // Update immediately
    updateKeys();
    
    // Method 3: Add important CSS rule for all shapes
    let existingStyle = document.getElementById('keyBgStyle');
    if (existingStyle) {
        existingStyle.remove();
    }
    
    const style = document.createElement('style');
    style.id = 'keyBgStyle';
    style.innerHTML = `
        .key:not(.next) { 
            background-color: ${color} !important; 
        }
        .keyboard.circular .key:not(.next) { 
            background-color: ${color} !important; 
        }
        .keyboard.split .key:not(.next) { 
            background-color: ${color} !important; 
        }
        .keyboard.raised .key:not(.next) { 
            background-color: ${color} !important; 
        }
        .keyboard.flat .key:not(.next) { 
            background-color: ${color} !important; 
        }
        .keyboard.neon .key:not(.next) { 
            background-color: ${color} !important; 
        }
    `;
    document.head.appendChild(style);
    
    localStorage.setItem('keyBgColor', color);
    
    // Show notification
    if (typeof showNotification === 'function') {
        showNotification('🎨 Key background color updated!', 'success');
    }
}

// Updated changeKeyboardTextColor function
function changeKeyboardTextColor() {
    const color = document.getElementById('keyboardTextColorPicker').value;
    
    // Update CSS variable
    document.documentElement.style.setProperty('--keyboard-text-color', color);
    
    // Force update all keys immediately
    document.querySelectorAll('.key').forEach(key => {
        key.style.color = color + ' !important';
    });
    
    // Add CSS rule for all shapes
    let existingStyle = document.getElementById('keyTextStyle');
    if (existingStyle) {
        existingStyle.remove();
    }
    
    const style = document.createElement('style');
    style.id = 'keyTextStyle';
    style.innerHTML = `
        .key { 
            color: ${color} !important; 
        }
        .keyboard.circular .key { 
            color: ${color} !important; 
        }
        .keyboard.split .key { 
            color: ${color} !important; 
        }
        .keyboard.raised .key { 
            color: ${color} !important; 
        }
        .keyboard.flat .key { 
            color: ${color} !important; 
        }
        .keyboard.neon .key { 
            color: ${color} !important; 
        }
    `;
    document.head.appendChild(style);
    
    localStorage.setItem('keyboardTextColor', color);
    
    // Show notification
    if (typeof showNotification === 'function') {
        showNotification('🎨 Keyboard text color updated!', 'success');
    }
}

// Add this function to your script.js file
function changeKeyboardShape() {
    const shape = document.getElementById('keyboardShapeSelect').value;
    const keyboard = document.getElementById('keyboard');
    
    if (!keyboard) return;
    
    // Remove all existing shape classes
    keyboard.classList.remove('circular', 'split', 'raised', 'neon', 'flat');
    
    // Add new shape class if not default
    if (shape !== 'default') {
        keyboard.classList.add(shape);
    }
    
    // Save to localStorage
    localStorage.setItem('keyboardShape', shape);
    
    // Show notification
    if (typeof showNotification === 'function') {
        showNotification(`🎨 Keyboard shape changed to: ${shape}`, 'info');
    }
    
    console.log('Keyboard shape changed to:', shape);
}

function changeZoom() {
    const zoom = document.getElementById('zoomSlider').value;
    updateZoomLevel(parseInt(zoom));
}

function changeKeyboardSize() {
    const size = document.getElementById('keyboardSizeSlider').value;
    document.getElementById('keyboardSizeValue').textContent = Math.round(size * 100) + '%';
    document.getElementById('keyboard').style.transform = `scale(${size})`;
    localStorage.setItem('keyboardSize', size);
}

function changeMistakeSound() {
    currentMistakeSound = document.getElementById('soundSelect').value;
    localStorage.setItem('mistakeSound', currentMistakeSound);
}

function changeTextBoxRows() {
    const rows = document.getElementById('textBoxRowsSlider').value;
    document.getElementById('textBoxRowsValue').textContent = rows + ' rows';
    const textDisplay = document.getElementById('textDisplay');
    textDisplay.style.minHeight = (rows * 30) + 'px';
    localStorage.setItem('textBoxRows', rows);
}

function changeKeyboardTheme() {
    const theme = document.getElementById('keyboardThemeSelect').value;
    const keyboard = document.getElementById('keyboard');
    
    keyboard.classList.remove('gaming', 'retro', 'neon');
    
    if (theme !== 'default') {
        keyboard.classList.add(theme);
    }
    
    localStorage.setItem('keyboardTheme', theme);
}

function toggleKeyboardVisibility() {
    const visibility = document.getElementById('keyboardVisibilitySelect').value;
    const keyboard = document.getElementById('keyboard');
    
    if (visibility === 'hide') {
        keyboard.classList.add('hidden');
    } else {
        keyboard.classList.remove('hidden');
    }
    
    localStorage.setItem('keyboardVisibility', visibility);
}

function enableKeyboardClicks() {
    const keys = document.querySelectorAll('.key');
    keys.forEach(key => {
        key.addEventListener('click', handleKeyClick);
    });
}

function handleKeyClick(event) {
    if (!typingAllowed) return;
    const keyElement = event.target;
    const keyData = keyElement.getAttribute('data-key');
    
    if (!keyData) return;
    
    let keyToType = '';
    
    if (keyData === 'space') {
        keyToType = ' ';
    } else if (keyData === 'backspace') {
        if (currentIndex > 0) {
            currentIndex--;
            const charElement = document.querySelector(`[data-index="${currentIndex}"]`);
            if (charElement) {
                charElement.classList.remove('correct', 'incorrect');
            }
            updateCurrentCharacterHighlight();
            updateScrollPosition();
            updateNextCharacterHighlight();
            updateFingerHint();
            updateStats();
        }
        return;
    } else if (['shift', 'ctrl', 'alt', 'caps'].includes(keyData)) {
        if (keyData === 'shift') {
            isShiftPressed = !isShiftPressed;
            updateKeyboardShift();
        }
        return;
    } else {
        if (isShiftPressed) {
            const shiftMap = {
                '1': '!', '2': '@', '3': '#', '4': '$', '5': '%',
                '6': '^', '7': '&', '8': '*', '9': '(', '0': ')',
                '-': '_', '=': '+', '[': '{', ']': '}', '\\': '|',
                ';': ':', "'": '"', ',': '<', '.': '>', '/': '?', '`': '~'
            };
            
            if (shiftMap[keyData]) {
                keyToType = shiftMap[keyData];
            } else if (keyData.match(/[a-z]/)) {
                keyToType = keyData.toUpperCase();
            } else {
                keyToType = keyData;
            }
        } else {
            keyToType = keyData;
        }
    }
    
    if (keyToType) {
        keyElement.classList.add('active');
        setTimeout(() => {
            keyElement.classList.remove('active');
        }, 150);
        
        processTypedCharacter(keyToType);
    }
}

function resetAllSettings() {
    if (confirm('Are you sure you want to reset all settings to default values? This will clear all your customizations!')) {
        // Clear all localStorage settings
        const settingsKeys = ['theme', 'fontSize', 'zoom', 'keyboardSize', 'mistakeSound', 
                             'textBoxRows', 'keyboardTheme', 'touchTypingEnabled', 
                             'keyboardVisibility', 'keyBgColor', 'keyboardTextColor'];
        
        settingsKeys.forEach(key => localStorage.removeItem(key));
        localStorage.setItem('deviceMode', 'tablet');
        
        // Reset to default values
        document.body.setAttribute('data-theme', 'night');
        document.getElementById('themeSelect').value = 'night';
        document.getElementById('deviceModeSelect').value = 'tablet';
        document.getElementById('fontSizeSlider').value = '35';
        document.getElementById('fontSizeValue').textContent = '35px';
        document.getElementById('textDisplay').style.fontSize = '35px';
        
        updateZoomLevel(88);
        
        document.getElementById('keyboardSizeSlider').value = '1';
        document.getElementById('keyboardSizeValue').textContent = '100%';
        document.getElementById('keyboard').style.transform = 'scale(1)';
        
        document.getElementById('soundSelect').value = 'sound1';
        currentMistakeSound = 'sound1';
        
        document.getElementById('textBoxRowsSlider').value = '1';
        document.getElementById('textBoxRowsValue').textContent = '1 rows';
        document.getElementById('textDisplay').style.minHeight = '30px';
        
        document.getElementById('keyboardThemeSelect').value = 'default';
        const keyboard = document.getElementById('keyboard');
        keyboard.classList.remove('gaming', 'retro', 'neon');
        
        document.getElementById('keyboardVisibilitySelect').value = 'show';
        keyboard.classList.remove('hidden');
        
        // Reset colors
        document.getElementById('keyBgColorPicker').value = '#f0f0f0';
        document.getElementById('keyboardTextColorPicker').value = '#000000';
        changeKeyBackgroundColor();
        changeKeyboardTextColor();
        
        touchTypingEnabled = true;
        keyboard.classList.add('touch-typing-enabled');
        enableKeyboardClicks();
        
        changeDeviceMode();
        
        showNotification('✅ All settings reset to default!', 'success');
    }
}

// Load settings from localStorage
function loadSettings() {
    const theme = localStorage.getItem('theme') || 'night';
    const fontSize = localStorage.getItem('fontSize') || '35';
    const zoom = localStorage.getItem('zoom') || '88';
    const keyBgColor = localStorage.getItem('keyBgColor') || '#f0f0f0';
    const keyboardTextColor = localStorage.getItem('keyboardTextColor') || '#000000';
    const keyboardSize = localStorage.getItem('keyboardSize') || '1';
    const mistakeSound = localStorage.getItem('mistakeSound') || 'sound1';
    const textBoxRows = localStorage.getItem('textBoxRows') || '1';
    const keyboardTheme = localStorage.getItem('keyboardTheme') || 'default';
    const keyboardVisibility = localStorage.getItem('keyboardVisibility') || 'show';
    
    document.body.setAttribute('data-theme', theme);
    document.getElementById('themeSelect').value = theme;
    
    document.getElementById('fontSizeSlider').value = fontSize;
    document.getElementById('fontSizeValue').textContent = fontSize + 'px';
    document.getElementById('textDisplay').style.fontSize = fontSize + 'px';
    
    document.getElementById('zoomSlider').value = zoom;
    document.getElementById('zoomValue').textContent = zoom + '%';
    document.body.style.zoom = zoom + '%';
    currentZoomLevel = parseInt(zoom);
    
    // Load key background color
    document.getElementById('keyBgColorPicker').value = keyBgColor;
    setTimeout(() => {
        changeKeyBackgroundColor();
    }, 100);
    
    document.getElementById('keyboardTextColorPicker').value = keyboardTextColor;
    document.documentElement.style.setProperty('--keyboard-text-color', keyboardTextColor);
    
    document.getElementById('keyboardSizeSlider').value = keyboardSize;
    document.getElementById('keyboardSizeValue').textContent = Math.round(keyboardSize * 100) + '%';
    document.getElementById('keyboard').style.transform = `scale(${keyboardSize})`;
    
    document.getElementById('soundSelect').value = mistakeSound;
    currentMistakeSound = mistakeSound;
    
    document.getElementById('textBoxRowsSlider').value = textBoxRows;
    document.getElementById('textBoxRowsValue').textContent = textBoxRows + ' rows';
    document.getElementById('textDisplay').style.minHeight = (textBoxRows * 30) + 'px';
    
    document.getElementById('keyboardThemeSelect').value = keyboardTheme;
    const keyboard = document.getElementById('keyboard');
    keyboard.classList.remove('gaming', 'retro', 'neon');
    if (keyboardTheme !== 'default') {
        keyboard.classList.add(keyboardTheme);
    }
    
    document.getElementById('keyboardVisibilitySelect').value = keyboardVisibility;
    if (keyboardVisibility === 'hide') {
        keyboard.classList.add('hidden');
    }
    
    touchTypingEnabled = true;
    keyboard.classList.add('touch-typing-enabled');
    enableKeyboardClicks();
    
    gamification.updateDisplay();
    
// Load keyboard shape
const keyboardShape = localStorage.getItem('keyboardShape') || 'default';
const keyboardShapeSelect = document.getElementById('keyboardShapeSelect');
if (keyboardShapeSelect) {
    keyboardShapeSelect.value = keyboardShape;
    
    // Apply the shape
    setTimeout(() => {
        changeKeyboardShape();
    }, 100);
}
}

// Device mode functions
function changeDeviceMode() {
    const mode = document.getElementById('deviceModeSelect').value;
    const wrapper = document.getElementById('appWrapper');
    wrapper.className = '';
    
    if (mode === 'mobile') wrapper.classList.add('simulate-mobile');
    else if (mode === 'tablet') wrapper.classList.add('simulate-tablet');
    else if (mode === 'desktop') wrapper.classList.add('simulate-desktop');
    else if (mode === 'auto') {
        const width = window.innerWidth;
        if (width <= 480) wrapper.classList.add('simulate-mobile');
        else if (width <= 768) wrapper.classList.add('simulate-tablet');
        else wrapper.classList.add('simulate-tablet');
    }
    
    localStorage.setItem('deviceMode', mode);
}

// Typing control functions
function toggleTyping() {
    const btn = document.getElementById('startStopBtn');
    const keyboard = document.getElementById('keyboard');
    
    if (!typingAllowed) {
        typingAllowed = true;
        btn.textContent = '⏸️ Stop Typing';
        btn.className = 'start-stop-btn stop-btn';
        keyboard.classList.remove('disabled');
        
        loadLesson();
        updateNextCharacterHighlight();
        updateFingerHint();
    } else {
        typingAllowed = false;
        btn.textContent = '▶️ Start Typing';
        btn.className = 'start-stop-btn start-btn';
        keyboard.classList.add('disabled');
        
        if (timer) {
            clearInterval(timer);
            timer = null;
        }
        startTime = null;
    }
}

function disableTypingInitially() {
        typingAllowed = false;
        const btn = document.getElementById('startStopBtn');
        const keyboard = document.getElementById('keyboard');
        const container = document.querySelector('.container');
        
        if (btn) {
            btn.textContent = '▶️ Start Typing';
            btn.className = 'start-stop-btn start-btn';
        }
        
        if (keyboard) {
            keyboard.classList.add('disabled');
        }
        
        if (container) {
            container.classList.add('typing-disabled');
        }
    }

// Modal functions
let selectedLevel = null;
let selectedLesson = null;

function openLevelsModal() {
    selectedLevel = null;
    document.getElementById('levelsModal').classList.add('open');
    document.body.classList.add('panel-open');
    loadLevels();
}

function closeLevelsModal() {
    selectedLevel = null;
    document.getElementById('levelsModal').classList.remove('open');
    document.body.classList.remove('panel-open');
}

function openLessonsModal() {
    selectedLesson = null;
    document.getElementById('lessonsModal').classList.add('open');
    document.body.classList.add('panel-open');
    loadLessons();
}

function closeLessonsModal() {
    selectedLesson = null;
    document.getElementById('lessonsModal').classList.remove('open');
    document.body.classList.remove('panel-open');
}

// Load levels into modal
function loadLevels() {
    const levels = JSON.parse(localStorage.getItem('customLevels')) || { ...defaultLevels };
    const grid = document.getElementById('levelsGrid');
    grid.innerHTML = '';
    
    Object.keys(levels).forEach(levelKey => {
        const level = levels[levelKey];
        const card = document.createElement('div');
        card.className = 'level-card';
        if (levelKey === currentLevel) {
            card.classList.add('active');
        }
        if (levelKey === selectedLevel) {
            card.style.border = '3px solid #FF9800';
            card.style.backgroundColor = '#FFF3E0';
        }
        
        const isCustom = !defaultLevels[levelKey];
        card.innerHTML = `
            <h4>${level.name} ${isCustom ? '(Custom)' : ''}</h4>
            <p>${level.description}</p>
        `;
        
        card.onclick = (e) => {
            e.stopPropagation();
            
            if (e.detail === 2) {
                currentLevel = levelKey;
                currentLesson = 1;
                loadLesson();
                closeLevelsModal();
            } else {
                selectedLevel = levelKey;
                loadLevels();
            }
        };
        
        grid.appendChild(card);
    });
}

// Load lessons into modal
function loadLessons() {
    const lessons = JSON.parse(localStorage.getItem('customLessons')) || { ...defaultLessons };
    const grid = document.getElementById('lessonsGrid');
    grid.innerHTML = '';
    
    const currentLevelLessons = lessons[currentLevel] || {};
    
    Object.keys(currentLevelLessons).forEach(lessonKey => {
        const card = document.createElement('div');
        card.className = 'lesson-card';
        if (lessonKey === currentLesson || parseInt(lessonKey) === currentLesson) {
            card.classList.add('active');
        }
        if (lessonKey === selectedLesson) {
            card.style.border = '3px solid #FF9800';
            card.style.backgroundColor = '#FFF3E0';
        }
        
        const isCustom = !defaultLessons[currentLevel] || !defaultLessons[currentLevel][lessonKey];
        const lessonText = currentLevelLessons[lessonKey];
        const preview = lessonText.length > 30 ? lessonText.substring(0, 30) + '...' : lessonText;
        
        card.innerHTML = `
            <h4>Lesson ${lessonKey} ${isCustom ? '(Custom)' : ''}</h4>
            <p style="font-size: 12px; color: #666;">${preview}</p>
        `;
        
        card.onclick = (e) => {
            e.stopPropagation();
            
            if (e.detail === 2) {
                currentLesson = lessonKey;
                loadLesson();
                closeLessonsModal();
            } else {
                selectedLesson = lessonKey;
                loadLessons();
            }
        };
        
        grid.appendChild(card);
    });
}

// Custom level/lesson functions
function addCustomLevel() {
    const name = prompt('Enter level name:');
    const description = prompt('Enter level description:');
    
    if (name && description) {
        const levels = JSON.parse(localStorage.getItem('customLevels')) || { ...defaultLevels };
        const key = name.toLowerCase().replace(/\s+/g, '_');
        levels[key] = { name, description };
        localStorage.setItem('customLevels', JSON.stringify(levels));
        loadLevels();
        showNotification('✅ Level added successfully!', 'success');
    }
}

function addCustomLesson() {
    const text = prompt('Enter lesson text:');
    
    if (text) {
        const lessons = JSON.parse(localStorage.getItem('customLessons')) || { ...defaultLessons };
        if (!lessons[currentLevel]) {
            lessons[currentLevel] = {};
        }
        
        const lessonNumber = Object.keys(lessons[currentLevel]).length + 1;
        lessons[currentLevel][lessonNumber] = text;
        localStorage.setItem('customLessons', JSON.stringify(lessons));
        loadLessons();
        showNotification('✅ Lesson added successfully!', 'success');
    }
}

function editLevel() {
    if (!selectedLevel) {
        showNotification('⚠️ Please select a level first!', 'warning');
        return;
    }
    
    const levels = JSON.parse(localStorage.getItem('customLevels')) || { ...defaultLevels };
    const level = levels[selectedLevel];
    
    if (!level) {
        showNotification('❌ Level not found!', 'error');
        return;
    }
    
    const newName = prompt('Enter new level name:', level.name);
    const newDescription = prompt('Enter new level description:', level.description);
    
    if (newName && newDescription) {
        levels[selectedLevel] = { name: newName, description: newDescription };
        localStorage.setItem('customLevels', JSON.stringify(levels));
        loadLevels();
        showNotification('✅ Level updated successfully!', 'success');
    }
}

function editLesson() {
    if (!selectedLesson) {
        showNotification('⚠️ Please select a lesson first!', 'warning');
        return;
    }
    
    const lessons = JSON.parse(localStorage.getItem('customLessons')) || { ...defaultLessons };
    const currentLevelLessons = lessons[currentLevel] || {};
    const lessonText = currentLevelLessons[selectedLesson];
    
    if (!lessonText) {
        showNotification('❌ Lesson not found!', 'error');
        return;
    }
    
    const newText = prompt('Enter new lesson text:', lessonText);
    
    if (newText) {
        lessons[currentLevel][selectedLesson] = newText;
        localStorage.setItem('customLessons', JSON.stringify(lessons));
        loadLessons();
        showNotification('✅ Lesson updated successfully!', 'success');
    }
}

function deleteLevel() {
    if (!selectedLevel) {
        showNotification('⚠️ Please select a level first!', 'warning');
        return;
    }
    
    if (defaultLevels[selectedLevel]) {
        showNotification('❌ Cannot delete default levels!', 'error');
        return;
    }
    
    if (confirm(`Are you sure you want to delete the level "${selectedLevel}"?`)) {
        const levels = JSON.parse(localStorage.getItem('customLevels')) || { ...defaultLevels };
        delete levels[selectedLevel];
        localStorage.setItem('customLevels', JSON.stringify(levels));
        
        if (currentLevel === selectedLevel) {
            currentLevel = 'introduction';
            currentLesson = 1;
            loadLesson();
        }
        
        selectedLevel = null;
        loadLevels();
        showNotification('✅ Level deleted successfully!', 'success');
    }
}

function deleteLesson() {
    if (!selectedLesson) {
        showNotification('⚠️ Please select a lesson first!', 'warning');
        return;
    }
    
    const lessons = JSON.parse(localStorage.getItem('customLessons')) || { ...defaultLessons };
    const currentLevelLessons = lessons[currentLevel] || {};
    
    if (Object.keys(currentLevelLessons).length <= 1) {
        showNotification('❌ Cannot delete the only lesson!', 'error');
        return;
    }
    
    if (confirm(`Are you sure you want to delete lesson ${selectedLesson}?`)) {
        delete lessons[currentLevel][selectedLesson];
        
        const remainingLessons = Object.keys(lessons[currentLevel]).sort((a, b) => parseInt(a) - parseInt(b));
        const newLessons = {};
        remainingLessons.forEach((key, index) => {
            newLessons[index + 1] = lessons[currentLevel][key];
        });
        lessons[currentLevel] = newLessons;
        
        localStorage.setItem('customLessons', JSON.stringify(lessons));
        
        if (currentLesson === selectedLesson || currentLesson === parseInt(selectedLesson)) {
            currentLesson = 1;
            loadLesson();
        }
        
        selectedLesson = null;
        loadLessons();
        showNotification('✅ Lesson deleted successfully!', 'success');
    }
}

function resetLevels() {
    if (confirm('Reset all levels to default? This will remove all custom levels!')) {
        localStorage.removeItem('customLevels');
        selectedLevel = null;
        
        if (!defaultLevels[currentLevel]) {
            currentLevel = 'introduction';
            currentLesson = 1;
            loadLesson();
        }
        
        loadLevels();
        showNotification('✅ All levels reset to default!', 'success');
    }
}

function resetLessons() {
    if (confirm('Reset all lessons to default? This will remove all custom lessons!')) {
        localStorage.removeItem('customLessons');
        selectedLesson = null;
        currentLesson = 1;
        loadLesson();
        loadLessons();
        showNotification('✅ All lessons reset to default!', 'success');
    }
}

// Lesson control functions
function restartLesson() {
    loadLesson();
    showNotification('🔄 Lesson restarted!', 'info');
}

function nextLesson() {
    const lessons = JSON.parse(localStorage.getItem('customLessons')) || defaultLessons;
    const currentLevelLessons = lessons[currentLevel] || {};
    const lessonKeys = Object.keys(currentLevelLessons);
    
    let currentIndex = lessonKeys.indexOf(currentLesson.toString());
    if (currentIndex === -1) {
        currentIndex = lessonKeys.indexOf(currentLesson);
    }
    
    if (currentIndex < lessonKeys.length - 1) {
        currentLesson = lessonKeys[currentIndex + 1];
        loadLesson();
        showNotification('⏭️ Next lesson loaded!', 'info');
    } else {
        showNotification('🎉 You completed all lessons in this level!', 'success');
    }
}

// Show statistics
function showStats() {
    const stats = JSON.parse(localStorage.getItem('lessonStats')) || {};
    const key = `${currentLevel}-${currentLesson}`;
    const lessonStats = stats[key];
    
    if (lessonStats) {
        const message = `📊 Lesson Statistics:
Accuracy: ${lessonStats.accuracy}%
Speed: ${lessonStats.wpm} WPM
Errors: ${lessonStats.errors}
Time: ${Math.floor(lessonStats.time / 60)}:${Math.floor(lessonStats.time % 60).toString().padStart(2, '0')}
Date: ${new Date(lessonStats.date).toLocaleDateString()}`;
        
        showNotification(message, 'info');
    } else {
        showNotification('📊 No statistics available for this lesson yet.', 'info');
    }
}

// Fullscreen functionality
function toggleFullscreen() {
    if (!document.fullscreenElement) {
        enterFullscreen();
    } else {
        exitFullscreen();
    }
}

function enterFullscreen() {
    const elem = document.documentElement;
    if (elem.requestFullscreen) {
        elem.requestFullscreen().catch(err => {
            console.log('Fullscreen request failed:', err);
        });
    } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) {
        elem.msRequestFullscreen();
    }
}

function exitFullscreen() {
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
    }
}

function handleFullscreenChange() {
    if (!document.fullscreenElement &&
        !document.webkitFullscreenElement &&
        !document.msFullscreenElement &&
        !document.hidden) {
        setTimeout(() => {
            if (!document.fullscreenElement && !document.hidden) {
                enterFullscreen();
            }
        }, 1000);
    }
}

// Handle body clicks to close panels
function handleBodyClick(event) {
    const settingsPanel = document.getElementById('settingsPanel');
    const settingsBtn = document.querySelector('.settings-btn');
    
    if (!settingsPanel.contains(event.target) && !settingsBtn.contains(event.target)) {
        settingsPanel.classList.remove('open');
        document.body.classList.remove('panel-open');
    }
}

// Helper functions for keyboard shortcuts
function showZoomFeedback(message) {
    showNotification(message, 'info');
}

function closePanels() {
    const settingsPanel = document.getElementById('settingsPanel');
    if (settingsPanel) {
        settingsPanel.classList.remove('open');
    }
    
    const levelsModal = document.getElementById('levelsModal');
    if (levelsModal) {
        levelsModal.classList.remove('open');
    }
    
    const lessonsModal = document.getElementById('lessonsModal');
    if (lessonsModal) {
        lessonsModal.classList.remove('open');
    }
    
    const dashboardModal = document.getElementById('dashboardModal');
    if (dashboardModal) {
        dashboardModal.classList.remove('open');
    }
    
        const voiceHelpModal = document.getElementById('voiceHelpModal');
    if (voiceHelpModal) {
        voiceHelpModal.classList.remove('open');
    }
    
    document.body.classList.remove('panel-open');
}

// Initialize the application
function init() {
    loadSettings();
    createKeyboard();
    loadLevels();
    loadLessons();
    generateMistakeSounds();
    initVoiceRecognition();
    
    // Always enable touch typing
    touchTypingEnabled = true;
    const keyboard = document.getElementById('keyboard');
    keyboard.classList.add('touch-typing-enabled');
    enableKeyboardClicks();
    
    loadLesson();
    
    // Add event listeners
    document.addEventListener('keydown', handleKeyDown);
    document.addEventListener('keyup', handleKeyUp);
    document.addEventListener('click', handleBodyClick);
    
    // Add zoom event listeners
    document.addEventListener('touchstart', handleTouchStart, { passive: false });
    document.addEventListener('touchmove', handleTouchMove, { passive: false });
    document.addEventListener('touchend', handleTouchEnd, { passive: false });
    document.addEventListener('wheel', handleWheel, { passive: false });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(event) {
        if (event.ctrlKey) {
            switch(event.key.toLowerCase()) {
                case '0':
                    event.preventDefault();
                    updateZoomLevel(110);
                    showZoomFeedback('⌨️ Ctrl+0 - Zoom Reset!');
                    break;
                case '=':
                case '+':
                    event.preventDefault();
                    updateZoomLevel(currentZoomLevel + 10);
                    showZoomFeedback('🔍+ Zoom In');
                    break;
                case '-':
                    event.preventDefault();
                    updateZoomLevel(currentZoomLevel - 10);
                    showZoomFeedback('🔍- Zoom Out');
                    break;
                case 'r':
                    event.preventDefault();
                    updateZoomLevel(88);
                    showZoomFeedback('🔄 Zoom Reset to 88%');
                    break;
                case 'd':
                    event.preventDefault();
                    if (confirm('Reset all settings to default?')) {
                        resetAllSettings();
                        showZoomFeedback('⚙️ Settings Reset to Default');
                    }
                    break;
                case 'c':
                    event.preventDefault();
                    closePanels();
                    showZoomFeedback('❌ Panels Closed');
                    break;
            }
        }
    }, { passive: false });
    
    // Fullscreen event listeners
    document.addEventListener('fullscreenchange', handleFullscreenChange);
    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
    document.addEventListener('msfullscreenchange', handleFullscreenChange);
    
    // Handle F11 and Escape key behavior
    document.addEventListener('keydown', function(event) {
        if (event.key === 'F11') {
            event.preventDefault();
            event.stopPropagation();
            if (!document.fullscreenElement) {
                enterFullscreen();
            }
        }
    }, { capture: true, passive: false });
    
    document.addEventListener('keyup', function(event) {
        if (event.key === 'Escape' && document.fullscreenElement) {
            const modalsOpen = document.querySelector('.modal.open') ||
                document.querySelector('.settings-panel.open');
            
            if (!modalsOpen) {
                exitFullscreen();
            }
        }
    }, { passive: false });
    
    // Page visibility handlers
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden && !document.fullscreenElement) {
            setTimeout(() => {
                enterFullscreen();
            }, 500);
        }
    });
    
    window.addEventListener('focus', function() {
        if (!document.fullscreenElement) {
            setTimeout(() => {
                enterFullscreen();
            }, 200);
        }
    });
    
    // Set default device mode to tablet
    setTimeout(() => {
        document.getElementById('deviceModeSelect').value = 'tablet';
        localStorage.setItem('deviceMode', 'tablet');
        changeDeviceMode();
    }, 100);
    
    // Request fullscreen on load
    setTimeout(() => {
        enterFullscreen();
    }, 100);
    
    setTimeout(() => {
        if (!document.fullscreenElement) {
            enterFullscreen();
        }
    }, 1000);
    
    // Initialize gamification display
    gamification.updateDisplay();
    
    // Check for time-based achievements
    const currentHour = new Date().getHours();
    if (currentHour >= 0 && currentHour < 6 && !gamification.achievements.nightOwl.unlocked) {
        gamification.unlockAchievement('nightOwl');
    }
    if (currentHour >= 5 && currentHour < 7 && !gamification.achievements.earlyBird.unlocked) {
        gamification.unlockAchievement('earlyBird');
    }
    
    // Show welcome notification
    setTimeout(() => {
        showNotification('🎉 Welcome to Professional Typing Tutor!', 'success');
    }, 1500);
}

// Initialize when page loads
window.addEventListener('load', init);

// Handle fullscreen overlay
window.addEventListener('DOMContentLoaded', function() {
    const overlay = document.getElementById('fullscreenOverlay');
    
    function startApp() {
        overlay.style.display = 'none';
        enterFullscreen();
    }
    
    overlay.addEventListener('click', startApp);
    overlay.addEventListener('touchstart', startApp);
});

// Add CSS animations for notifications
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    .notification {
        animation: slideIn 0.3s ease-out;
    }
    
    .stat-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        padding: 5px 0;
        border-bottom: 1px solid var(--border-color);
    }
    
    .session-item {
        display: flex;
        justify-content: space-between;
        padding: 8px;
        margin: 5px 0;
        background: var(--bg-color);
        border-radius: 3px;
        border-left: 4px solid var(--primary-color);
    }
    
    .theme-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    
    .theme-actions .control-btn {
        flex: 1;
    }
`;
document.head.appendChild(style);

// Export functions for global access
window.openDashboard = openDashboard;
window.closeDashboard = closeDashboard;
window.switchTab = switchTab;
window.openVoiceHelp = openVoiceHelp;
window.closeVoiceHelp = closeVoiceHelp;
window.toggleVoiceRecognition = toggleVoiceRecognition;
window.exportProgress = exportProgress;
window.importProgress = importProgress;
window.toggleLock = toggleLock;
window.toggleSettings = toggleSettings;
window.closeSettings = closeSettings;
window.changeTheme = changeTheme;
window.changeFontSize = changeFontSize;
window.changeKeyBackgroundColor = changeKeyBackgroundColor;
window.changeKeyboardTextColor = changeKeyboardTextColor;
window.changeZoom = changeZoom;
window.changeDeviceMode = changeDeviceMode;
window.changeKeyboardSize = changeKeyboardSize;
window.changeMistakeSound = changeMistakeSound;
window.changeTextBoxRows = changeTextBoxRows;
window.changeKeyboardTheme = changeKeyboardTheme;
window.toggleKeyboardVisibility = toggleKeyboardVisibility;
window.resetAllSettings = resetAllSettings;
window.openLevelsModal = openLevelsModal;
window.closeLevelsModal = closeLevelsModal;
window.openLessonsModal = openLessonsModal;
window.closeLessonsModal = closeLessonsModal;
window.addCustomLevel = addCustomLevel;
window.addCustomLesson = addCustomLesson;
window.editLevel = editLevel;
window.editLesson = editLesson;
window.deleteLevel = deleteLevel;
window.deleteLesson = deleteLesson;
window.resetLevels = resetLevels;
window.resetLessons = resetLessons;
window.restartLesson = restartLesson;
window.nextLesson = nextLesson;
window.showStats = showStats;
window.toggleTyping = toggleTyping;
window.toggleFullscreen = toggleFullscreen;

// Console welcome message
console.log(`
🎉 Professional Typing Tutor Loaded Successfully!

Features:
✅ Voice Commands (Hindi & English)
✅ Advanced Analytics & AI Insights
✅ Achievement System & Gamification
✅ Custom Theme Builder
✅ Progress Export/Import
✅ Professional Dashboard
✅ Touch & Gesture Controls
✅ Responsive Design

Keyboard Shortcuts:
• Ctrl + 0: Reset Zoom
• Ctrl + +/-: Zoom In/Out
• Ctrl + R: Reset Zoom to 88%
• Ctrl + D: Reset Settings
• Ctrl + C: Close Panels
• F11: Toggle Fullscreen

Voice Commands:
• "शुरू करो" / "Start typing"
• "रोको" / "Stop"
• "अगला पाठ" / "Next lesson"
• "सेटिंग्स खोलो" / "Open settings"

Enjoy your professional typing experience! 🚀
`);

// आपके existing voice functions के बाद यहाँ add करें
function handleVoiceCommand(event) {
    // ... आपका existing code ...
}

// 👇 यहाँ add करें - Voice functions के बाद
function switchHelpTab(tabName) {
    // Remove active class from all tabs and content
    document.querySelectorAll('.help-tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelectorAll('.help-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Add active class to clicked tab and corresponding content
    event.target.classList.add('active');
    document.getElementById(tabName + 'Tab').classList.add('active');
}

// आपका existing openVoiceHelp function को replace करें
function openVoiceHelp() {
    document.getElementById('voiceHelpModal').classList.add('open');
    document.body.classList.add('panel-open');
    
    // Default to voice commands tab
    setTimeout(() => {
        const voiceTab = document.querySelector('[onclick="switchHelpTab(\'voice\')"]');
        if (voiceTab) {
            voiceTab.classList.add('active');
            document.getElementById('voiceTab').classList.add('active');
        }
    }, 100);
}

function closeVoiceHelp() {
    document.getElementById('voiceHelpModal').classList.remove('open');
    document.body.classList.remove('panel-open');
}
    
    </script>
</body>
</html>
